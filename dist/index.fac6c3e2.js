function t(t,i,e,s){Object.defineProperty(t,i,{get:e,set:s,enumerable:!0,configurable:!0})}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},s={},r=i.parcelRequire62ee;null==r&&((r=function(t){if(t in e)return e[t].exports;if(t in s){var i=s[t];delete s[t];var r={id:t,exports:{}};return e[t]=r,i.call(r.exports,r,r.exports),r.exports}var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,i){s[t]=i},i.parcelRequire62ee=r),r.register("kyEFX",(function(i,e){var s,r;t(i.exports,"register",(function(){return s}),(function(t){return s=t})),t(i.exports,"resolve",(function(){return r}),(function(t){return r=t}));var n={};s=function(t){for(var i=Object.keys(t),e=0;e<i.length;e++)n[i[e]]=t[i[e]]},r=function(t){var i=n[t];if(null==i)throw new Error("Could not resolve bundle with id "+t);return i}})),r("kyEFX").register(JSON.parse('{"GHvDZ":"index.fac6c3e2.js","gVigP":"main.841fdef8.js"}'));const n="loading";class o extends Error{}function h(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}class c{render(){}constructor(t){this.context=t}}class a extends c{render(){this.context.beginPath(),this.context.arc(this.x,this.y,this.r,0,2*Math.PI),this.context.fillStyle=this.color,this.context.fill()}constructor(t,i,e,s,r){super(t),h(this,"x",0),h(this,"y",0),h(this,"r",0),h(this,"color","#00ff00"),this.x=i,this.y=e,this.r=s,r&&(this.color=r)}}const l=1e-6;class u extends Error{}class d{add(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return this.x-=t.x,this.y-=t.y,this}flipY(){return this.y=-this.y,this}flipX(){return this.x=-this.x,this}flip(){return this.x=-this.x,this.y=-this.y,this}equals(t){return v.distance(this,t)<l}sum(t){return new d(this.x+t.x,this.y+t.y)}diff(t){return new d(this.x-t.x,this.y-t.y)}mul(t){return new d(this.x*t,this.y*t)}copy(){return new d(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){const t=this.length;return new d(this.x/t,this.y/t)}get perpendicular(){if(0===this.x){if(this.y>0)return d.Horizontal().normalized;if(this.y<0)return d.Horizontal().normalized.flip();throw new u}if(0===this.y){if(this.x>0)return d.Vertical().normalized;if(this.x<0)return d.Vertical().normalized.flip()}return new d(-this.y/this.x,1).normalized}static Zero(){return new d(0,0)}static Horizontal(){return new d(1,0)}static Vertical(){return new d(0,1)}constructor(t,i){h(this,"x",0),h(this,"y",0),this.x=t,this.y=i}}class f{inBetween(t){const i=v.diff(t,this.vec1).length,e=v.diff(this.vec2,t).length,s=v.diff(this.vec1,this.vec2).length;return r=s,n=i+e,o=l,Math.abs(r-n)<o;var r,n,o}calculateKB(){this.vec1.y===this.vec2.y?(this.b=this.vec1.y,this.k=0):this.vec1.x===this.vec2.x?(this.b=NaN,this.k=NaN):(this.b=(this.vec1.x*this.vec2.y-this.vec1.y*this.vec2.x)/(this.vec1.x-this.vec2.x),this.k=(this.vec1.y-this.vec2.y)/(this.vec1.x-this.vec2.x))}makeVec2FromX(t){return new d(t,this.k*t+this.b)}get B(){return this.b}get K(){return this.k}get length(){return v.distance(this.vec1,this.vec2)}get direction(){return v.diff(this.vec1,this.vec2)}static Vertical(t){return new f(new d(t,0),new d(t,Number.MAX_SAFE_INTEGER))}static Horizontal(t){return new f(new d(0,t),new d(Number.MAX_SAFE_INTEGER,t))}constructor(t,i){h(this,"vec1",d.Zero()),h(this,"vec2",d.Zero()),h(this,"k",0),h(this,"b",0),this.vec1=t,this.vec2=i,this.calculateKB()}}class p extends Error{}class v{static diff(t,i){return new d(t.x-i.x,t.y-i.y)}static mul(t,i){return new d(t.x*i,t.y*i)}static distance(t,i){return v.diff(t,i).length}static intersect(t,i){if(t.K===i.K)throw new p;if(isNaN(t.K)||isNaN(i.K))return isNaN(t.K)?i.makeVec2FromX(t.vec1.x):t.makeVec2FromX(i.vec1.x);{const e=(t.B-i.B)/(i.K-t.K);return t.makeVec2FromX(e)}}static dot(t,i){return t.x*i.x+t.y*i.y}static mirror(t,i){const e=i.direction.perpendicular.normalized;return t.copy().sub(e.mul(2*v.dot(t,e)))}}class w{update(t){const i=this.velocity;this.previousPosition=this.currentPosition.copy(),this.currentPosition.add(i.add(this.acc.mul(t*t))),this.acc=d.Zero()}accelerate(t){this.acc.add(t)}collide(t){const i=v.diff(this.currentPosition,t.currentPosition),e=i.length,s=this.radius+t.radius;if(e<this.radius+t.radius){const r=i.normalized,n=s-e;this.currentPosition.add(v.mul(r,this.radius/s*n*this.bounceValue)),t.currentPosition.sub(v.mul(r,t.radius/s*n*t.bounceValue))}}flip(){const t=this.currentPosition.copy();this.currentPosition=this.previousPosition,this.previousPosition=t}get velocity(){return v.diff(this.currentPosition,this.previousPosition)}set velocity(t){this.previousPosition=v.diff(this.currentPosition,t)}get movementVector(){return new f(this.previousPosition,this.currentPosition)}constructor(t){h(this,"previousPosition",d.Zero()),h(this,"currentPosition",d.Zero()),h(this,"acc",d.Zero()),h(this,"radius",10),h(this,"bounceValue",1.1),this.previousPosition=t,this.currentPosition=t}}class m{applyConstrain(t){}constructor(){}}class x extends m{get width(){return this._width}set width(t){this._width=t,this.recalculateSides()}get height(){return this._height}set height(t){this._height=t,this.recalculateSides()}recalculateSides(){this.top=new f(new d(this._width,0),new d(0,0)),this.right=new f(new d(this._width,0),new d(this._width,this._height)),this.bottom=new f(new d(0,this._height),new d(this._width,this._height)),this.left=new f(new d(0,this._height),new d(0,0))}applyConstrain(t){super.applyConstrain(t),this.checkConstrainWithSide(t,this.right),this.checkConstrainWithSide(t,this.left),this.checkConstrainWithSide(t,this.bottom),this.checkConstrainWithSide(t,this.top)}checkConstrainWithSide(t,i){const e=t.velocity,s=t.movementVector;e.copy().flip();try{const e=v.intersect(i,s),r=v.distance(e,t.currentPosition);if(r<t.radius){console.log(r);const s=i.direction.perpendicular.normalized;console.log(e,s),t.currentPosition=e.sum(s.mul(t.radius*t.bounceValue)),console.log(t.currentPosition)}}catch(t){}}constructor(t,i){super(),h(this,"_width",0),h(this,"_height",0),h(this,"left",f.Vertical(0)),h(this,"top",f.Horizontal(0)),h(this,"right",f.Vertical(0)),h(this,"bottom",f.Horizontal(0)),this.width=t,this.height=i}}class y extends m{applyConstrain(t){super.applyConstrain(t);const i=t.currentPosition.diff(this.center),e=i.length,s=t.radius;if(e>this.radius-s){const e=i.normalized;t.currentPosition=this.center.sum(e.mul(this.radius-s))}}constructor(t,i){super(),h(this,"center",d.Zero()),h(this,"radius",0),this.center=t,this.radius=i}}class g{getNextObject(t){return null}constructor(t){h(this,"solver",null),this.solver=t}}class b{constructor(t,i){h(this,"timeout",void 0),h(this,"object",void 0),this.timeout=t,this.object=i}}class P extends g{getNextObject(t){if(!(this.total>this.limit)&&(this.lastCreateTime+=t,this.lastCreateTime>this.delay)){const t=this.create();return this.lastCreateTime=0,this.total++,t}}constructor(t,i,e,s){super(t),this.limit=i,this.total=0,this.delay=e,this.create=s,this.lastCreateTime=0}}class S{configure(){this.gravity=new d(0,100)}update(t){const i=t/this.subSteps;for(let t=0;t<this.subSteps;t++)this.applyGravity(),this.applyConstrains(),this.processCollisions(),this.updateObjects(i)}updateObjects(t){this.objects.forEach((i=>i.update(t)))}applyGravity(){this.objects.forEach((t=>t.accelerate(this.gravity)))}applyConstrains(){this.objects.forEach((t=>this.constrains.applyConstrain(t)))}processCollisions(){this.objects.forEach((t=>{this.objects.forEach((i=>{t!==i&&t.collide(i)}))}))}constructor(){h(this,"objects",[]),h(this,"constrains",null),this.gravity=d.Zero(),this.objects=[],this.subSteps=8,this.configure()}}class C extends c{render(){this.context.fillStyle=this.color,this.context.fillRect(this.leftTop.x,this.leftTop.y,this.size.x,this.size.y)}constructor(t,i,e,s){super(t),h(this,"leftTop",d.Zero()),h(this,"size",d.Zero()),h(this,"color","#00ff00"),this.leftTop=i,this.size=e,s&&(this.color=s)}}new b(1,new w(new d(10,10))),new b(2,new w(new d(10,10))),new b(3,new w(new d(10,10)));class E{configure(){this.solver=new S,this.context.font="10px serif",this.switchToCircleConstrain(),this.solver.constrains=this.constrains,this.generator=new P(this.solver,100,.2,(()=>{const t=new w(new d(this.canvas.width/2,this.canvas.height/2));return t.velocity=new d(3,-.5).mul(1/this.solver.subSteps),t}))}update(t){const i=this.generator.getNextObject(t);i&&this.solver.objects.push(i),this.solver.update(t)}tick(){this.step<0&&(this.step=0),this.update(this.step/1e3),this.clear(),this.renderItems(),this.printFPS()}renderItems(){this.items.forEach((t=>t.render())),this.solver.objects.forEach((t=>{new a(this.context,t.currentPosition.x,t.currentPosition.y,t.radius).render()}))}printText(t,i,e){this.context.fillStyle="#000000",this.context.fillText(t,i,e)}printFPS(){this.printText(`${Math.round(this.step)} ms / ${Math.round(1e3/this.step)} FPS`,0,10)}clear(){this.context.fillStyle="#ffffff",this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}start(){self.requestAnimationFrame?self.requestAnimationFrame(this.nextFrame):setInterval(this.nextInterval,16)}switchToCircleConstrain(){this.constrains=new y(new d(this.canvas.width/2,this.canvas.height/2),this.canvas.height/2),this.items.push(new a(this.context,this.canvas.width/2,this.canvas.height/2,this.canvas.height/2,"#000000"))}switchToViewportConstrain(){this.constrains=new x(this.canvas.width,this.canvas.height),this.items.push(new C(this.context,d.Zero(),new d(this.canvas.width,this.canvas.height),"#000000"))}constructor(t){h(this,"objects",[]),h(this,"constrains",null),h(this,"solver",null),h(this,"nextFrame",(t=>{this.step=t-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=t,self.requestAnimationFrame(this.nextFrame)})),h(this,"nextInterval",(()=>{this.timeRenderStart=performance.now(),this.step=this.timeRenderStart-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=performance.now()})),this.canvas=t,this.context=this.canvas.getContext("2d"),this.timeRenderStart=performance.now(),this.timeRenderEnd=performance.now(),this.step=0,this.items=[],this.generator=null,this.solver=null,this.configure()}}var _,j={};_=function(t,i,e){if(i===self.location.origin)return t;var s=e?"import "+JSON.stringify(t)+";":"importScripts("+JSON.stringify(t)+");";return URL.createObjectURL(new Blob([s],{type:"application/javascript"}))};let k=new URL(r("kyEFX").resolve("gVigP"),import.meta.url);var N;j=_(k.toString(),k.origin,!0),N=function(){console.log("Init application");const t=function(t){const i=document.querySelector(t);if(!i)throw new o(t);return i}("#image_canvas");if(t.transferControlToOffscreen){console.log("Render in worker");const i=new Worker(j),e=t.transferControlToOffscreen();i.postMessage({canvas:e},[e])}else console.log("Render in main thread"),new E(t).start()},document.readyState!==n?N():document.addEventListener("DOMContentLoaded",N);
//# sourceMappingURL=index.fac6c3e2.js.map
