!function(){function t(t,e,s,i){Object.defineProperty(t,e,{get:s,set:i,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},i={},n=e.parcelRequire62ee;null==n&&((n=function(t){if(t in s)return s[t].exports;if(t in i){var e=i[t];delete i[t];var n={id:t,exports:{}};return s[t]=n,e.call(n.exports,n,n.exports),n.exports}var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(t,e){i[t]=e},e.parcelRequire62ee=n),n.register("gTwGg",(function(e,s){var i,n;t(e.exports,"register",(function(){return i}),(function(t){return i=t})),t(e.exports,"resolve",(function(){return n}),(function(t){return n=t}));var o={};i=function(t){for(var e=Object.keys(t),s=0;s<e.length;s++)o[e[s]]=t[e[s]]},n=function(t){var e=o[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),n("gTwGg").register(JSON.parse('{"jFVjc":"index.97db1f2c.js","iHdMw":"main.08d94631.js"}'));const o="loading";class r extends Error{}function h(t){const e=document.querySelector(t);if(!e)throw new r(t);return e}class c{addHandlers(){this._canvas.addEventListener("mouseenter",this.mouseEnter),this._canvas.addEventListener("mouseleave",this.mouseLeave),this._canvas.addEventListener("mousemove",this.mouseMove),this._canvas.addEventListener("mousedown",this.mouseDown),this._canvas.addEventListener("mouseup",this.mouseUp),this._canvas.addEventListener("click",this.click),this._canvas.addEventListener("touchstart",this.touchStart,{passive:!1}),this._canvas.addEventListener("touchmove",this.touchMove,{passive:!1}),this._canvas.addEventListener("touchcancel",this.touchCancel,{passive:!1}),this._canvas.addEventListener("touchend",this.touchEnd,{passive:!1}),document.addEventListener("keypress",this.keyPress)}removeHandlers(){document.removeEventListener("keypress",this.keyPress)}processEvent(t){this._handlers.forEach((e=>{e(t)})),this._oldX=t.screenX,this._oldY=t.screenY}addHandler(t){this._handlers.add(t)}removeHandler(t){this._handlers.has(t)&&this._handlers.delete(t)}createMouseEvent(t){return{screenX:t.offsetX,screenY:t.offsetY,dx:-this._oldX+t.offsetX,dy:-this._oldY+t.offsetY,leftButtonDown:this._leftButtonDown}}createTouchEvent(t){const e=t.touches.item(0);return{screenX:e.pageX,screenY:e.pageY,dx:-this._oldX+e.pageX,dy:-this._oldY+e.pageY,leftButtonDown:this._leftButtonDown}}createTouchEndEvent(){return{screenX:this._oldX,screenY:this._oldY,dx:0,dy:0,leftButtonDown:this._leftButtonDown}}constructor(t){this.keyPress=t=>{const e={keyPressed:t.key};this.processEvent(e)},this.mouseEnter=t=>{const e=this.createMouseEvent(t);this.processEvent(e)},this.mouseLeave=t=>{const e=this.createMouseEvent(t);this.processEvent(e)},this.mouseMove=t=>{const e=this.createMouseEvent(t);this.processEvent(e)},this.mouseDown=t=>{this._leftButtonDown=!0;const e=this.createMouseEvent(t);this.processEvent(e)},this.mouseUp=t=>{this._leftButtonDown=!1;const e=this.createMouseEvent(t);this.processEvent(e)},this.click=t=>{const e=this.createMouseEvent(t);this.processEvent(e)},this.touchStart=t=>{if(t.preventDefault(),0===t.touches.length)return;this._leftButtonDown=!0;const e=t.touches.item(0),s={screenX:e.pageX,screenY:e.pageY,dx:0,dy:0,leftButtonDown:this._leftButtonDown};this.processEvent(s)},this.touchMove=t=>{t.preventDefault();const e=this.createTouchEvent(t);e&&this.processEvent(e)},this.touchEnd=t=>{t.preventDefault(),this._leftButtonDown=!1;const e=this.createTouchEndEvent();e&&this.processEvent(e)},this.touchCancel=t=>{t.preventDefault(),this._leftButtonDown=!1;const e=this.createTouchEndEvent();e&&this.processEvent(e)},this._canvas=t,this._handlers=new Set,this._leftButtonDown=!1,this.addHandlers()}}var a,l;(l=a||(a={}))[l.MessageNone=0]="MessageNone",l[l.MessageInit=1]="MessageInit",l[l.MessageUserInput=2]="MessageUserInput",l[l.MessageEngineEvent=3]="MessageEngineEvent";class d{constructor(){this.type=a.MessageNone}}class u extends d{constructor(t){super(),this.type=a.MessageInit,this.canvas=t}}class g extends d{constructor(t){super(),this.type=a.MessageUserInput,this.event=t}}class f extends d{constructor(t){super(),this.type=a.MessageEngineEvent,this.event=t}}var p,v,y,x={};p=function(t,e,s){if(e===self.location.origin)return t;var i=s?"import "+JSON.stringify(t)+";":"importScripts("+JSON.stringify(t)+");";return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))};var m={};function _(t){return(""+t).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}v=function(t){var e=m[t];return e||(e=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(t)return _(t[2])}return"/"}(),m[t]=e),e},y=function(t){var e=(""+t).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!e)throw new Error("Origin not found");return e[0]};let w=v("jFVjc")+"../"+n("gTwGg").resolve("iHdMw");x=p(w,y(w),!1);class b{loadScene(t){const e={scene:t};this.sendEngineEvent(e)}}class S extends b{constructor(t){super(),this.sendUserInputEvent=t=>{this.worker.postMessage(new g(t))},this.sendEngineEvent=t=>{this.worker.postMessage(new f(t))},this.worker=new Worker(x);const e=t.transferControlToOffscreen();this.worker.postMessage(new u(e),[e]),this.userInput=new c(t),this.userInput.addHandler(this.sendUserInputEvent)}}class P extends Error{}class E extends P{}class j extends P{}class C extends P{}class k{static diff(t,e){return new B(t.x-e.x,t.y-e.y)}static mul(t,e){return new B(t.x*e,t.y*e)}static distance(t,e){return k.diff(t,e).length}static distance2(t,e){return k.diff(t,e).length2}static intersect(t,e){if(t.K===e.K)throw new E;if(isNaN(t.K)||isNaN(e.K))return isNaN(t.K)?e.makeVec2FromX(t._vec1.x):t.makeVec2FromX(e._vec1.x);{const s=(t.B-e.B)/(e.K-t.K);return t.makeVec2FromX(s)}}static dot(t,e){return t.x*e.x+t.y*e.y}static mirror(t,e){const s=e.direction.perpendicular;return t.diff(s.mul(2*k.dot(t,s)))}static scale(t,e){return new B(t.x/e.x,t.y/e.y)}}const R=1e-6,I=Math.sqrt(2);class B{get x(){return this._x}get y(){return this._y}set x(t){this._x=t,this.reset()}set y(t){this._y=t,this.reset()}get length(){return null===this._length&&(this._length=Math.sqrt(this.x*this.x+this.y*this.y),B.lengthCallsCount++),this._length}get length2(){return null===this._length2&&(this._length2=this._x*this._x+this._y*this._y,B.length2CallsCount++),this._length2}moveTo(t,e){t instanceof B?(this._x=t.x,this._y=t.y):(this._x=t,this._y=e),this.reset()}reset(){this._length=null,this._length2=null}addSelf(t){return this._x+=t.x,this._y+=t.y,this._length=null,this}moveBy(t){this.addSelf(t)}subSelf(t){return this._x-=t.x,this._y-=t.y,this._length=null,this}flipYSelf(){return this._y=-this._y,this}flipXSelf(){return this._x=-this._x,this}flipSelf(){return this._x=-this._x,this._y=-this._y,this}equals(t){return k.distance2(this,t)<1e-12}sum(t){return new B(this.x+t.x,this.y+t.y)}diff(t){return new B(this.x-t.x,this.y-t.y)}mul(t){return new B(this.x*t,this.y*t)}dot(t){return this.x*t.x+this.y*t.y}copy(){return new B(this.x,this.y)}applySelf(t){return this.x=t(this.x),this.y=t(this.y),this}isInsideRect(t,e){const s=Math.min(t.x,e.x),i=Math.min(t.y,e.y),n=Math.max(t.x,e.x),o=Math.max(t.y,e.y);return this._x>=s&&this._x<=n&&this._y>=i&&this._y<=o}get ort(){const t=this.length;return new B(this.x/t,this.y/t,1)}get abs(){return new B(Math.abs(this.x),Math.abs(this.y))}get perpendicular(){if(0===this.x){if(this.y>0)return B.Horizontal().ort;if(this.y<0)return B.Horizontal().ort.flipSelf();throw new j}if(0===this.y){if(this.x>0)return B.Vertical().ort;if(this.x<0)return B.Vertical().ort.flipSelf()}return new B(-this.y,this.x).ort}static Zero(){return new B(0,0)}static Horizontal(){return new B(1,0)}static Vertical(){return new B(0,1)}static Down(t){return new B(0,t)}static Right(t){return new B(t,0)}constructor(t,e,s){this._x=0,this._y=0,this._length=null,this._length2=null,this._x=t,this._y=void 0===e?t:e,s&&(this._length=s,this._length2=s*s)}}B.lengthCallsCount=0,B.length2CallsCount=0;class T{}class M{addObject(t){this.objects.length>=M.MAX_OBJECT_IN_CELL||this.objects.push(t)}clear(){this.objects=[],this.highlight=!1}remove(t){const e=this.objects.findIndex((e=>e.index===t));-1!==e&&this.objects.splice(e,1)}get count(){return this.objects.length}constructor(){this.objects=[],this.highlight=!1}}M.MAX_OBJECT_IN_CELL=100;class O extends T{get size(){return this._size}get width(){return this._width}set width(t){this._width=t,this.resize()}get height(){return this._height}set height(t){this._height=t,this.resize()}recalculateIndex2xy(){this.index2xy=[];for(let t=0;t<this._size;t++)this.index2xy.push(this.makeVecFromIndex(t))}recalculateCollisionCells(){this.adjacentCells=[],this.cells.forEach(((t,e)=>{const s=this.getVecFromIndex(e),i=[];i.push(t),s.y>0&&i.push(this.cells[this.makeIndexFromCoord(s.x,s.y-1)]),s.y+1<this._height&&i.push(this.cells[this.makeIndexFromCoord(s.x,s.y+1)]),s.x>0&&(s.y>0&&i.push(this.cells[this.makeIndexFromCoord(s.x-1,s.y-1)]),i.push(this.cells[this.makeIndexFromCoord(s.x-1,s.y)]),s.y+1<this._height&&i.push(this.cells[this.makeIndexFromCoord(s.x-1,s.y+1)])),s.x+1<this._width&&(s.y>0&&i.push(this.cells[this.makeIndexFromCoord(s.x+1,s.y-1)]),i.push(this.cells[this.makeIndexFromCoord(s.x+1,s.y)]),s.y+1<this._height&&i.push(this.cells[this.makeIndexFromCoord(s.x+1,s.y+1)])),this.adjacentCells[e]=i}))}getVecFromIndex(t){return this.index2xy[t]}resize(){this.cells=[],this._size=this._width*this._height;for(let t=0;t<this._size;t++)this.cells.push(new M);this.recalculateIndex2xy(),this.recalculateCollisionCells()}addObject(t){this.addObjectByIndex(0,t)}addPointObject(t,e,s){const i=Math.trunc(t/this.cellSize.x),n=Math.trunc(e/this.cellSize.y),o=this.makeIndexFromCoord(i,n);this.addObjectByIndex(o,s)}addObjectByIndex(t,e){!isNaN(t)&&t>=0&&t<this.size&&this.cells[t].addObject(e)}makeIndexFromVec(t){return t.x*this._height+t.y}makeIndexFromCoord(t,e){return t*this._height+e}makeVecFromIndex(t){const e=Math.trunc(t/this._height),s=t-e*this._height;return new B(e,s)}addRectangularObject(t,e,s){const i=k.scale(t,this.cellSize).applySelf(Math.trunc),n=k.scale(e,this.cellSize).applySelf(Math.trunc);let o=Math.max(Math.min(i.x,n.x),0),r=Math.max(Math.min(i.y,n.y),0),h=Math.min(Math.max(i.x,n.x),this._width-1),c=Math.min(Math.max(i.y,n.y),this._height-1);const a=this.makeIndexFromCoord(o,r),l=this.makeIndexFromCoord(h,c);if(!(h>=this._width||o<0||r<0||c>=this._height))if(i.x===n.x)for(let t=a;t<=l;t++)this.cells[t].addObject(s);else if(i.y===n.y)for(let t=a;t<=l;t+=this.height)this.cells[t].addObject(s);else{let t=c-r,e=this.makeIndexFromCoord(o,r);for(let i=0;i<=h-o;i++)for(let n=0;n<=t;n++){const t=e+this.makeIndexFromCoord(i,n);this.addObjectByIndex(t,s)}}}clear(){this.cells.forEach((t=>t.clear()))}forEach(t){this.cells.forEach(((e,s)=>{const i=this.getVecFromIndex(s);t(i.x,i.y,e,s)}))}hasCell(t,e){if(t<0||t>=this.size)return!1;const s=this.getVecFromIndex(t),i=s.x,n=s.y;return!(n<=0&&e<0)&&(!(n===this.height-1&&e>0)&&(!(0===i&&e<0)&&!(i>=this.width-1&&e>0)))}debugRender(t){this.forEach(((e,s,i,n)=>{const o=new B(e*this.cellSize.x,s*this.cellSize.y);t.strokeStyle(i.count>0?"#ff0000":"#00ff00"),t.lineWidth(i.highlight?10:1),t.rect(o.x,o.y,this.cellSize.x-1,this.cellSize.y-1),t.fillStyle("#ffffff"),t.text(`${n}`,o.sum(this.cellSize.mul(.5)))}))}constructor(t,e,s){super(),this.cells=[],this.index2xy=[],this.adjacentCells=[],this._width=t,this._height=e,this.cellSize=s,this.resize()}}class F{reset(){this.objects=[]}configure(){this.useFixedTime=!0,this.step=.017/this.subSteps}addObject(t){this.objects.push(t)}update(t){const e=this.useFixedTime?this.step:t/this.subSteps;for(let t=0;t<this.subSteps;t++)this.processOptimizations(),this.processCollisions(),this.applyForces(),this.updateObjects(e),this.applyConstrains()}updateObjects(t){this.objects.forEach((e=>e.update(t)))}applyConstrains(){this.objects.forEach((t=>this.constrains.applyConstrain(t)))}constructor(t,e){this.objects=[],this.constrains=null,this.subSteps=4,this.useFixedTime=!0,this.stats=e,this.objects=[],this.worldSize=t.copy(),this.configure()}}class z extends F{reset(){super.reset(),this.collisionGrid.clear()}configure(){super.configure(),this.gravity=new B(0,100),this.gravityCenter=new B(this.worldSize.x/2,this.worldSize.y/2);const t=Math.round(this.worldSize.x/16),e=Math.round(this.worldSize.y/16);this.cellSize=new B(this.worldSize.x/t,this.worldSize.y/e),this.collisionGrid=new O(t,e,this.cellSize)}processOptimizations(){this.collisionGrid.clear(),this.objects.forEach(((t,e)=>{t.addToSpace(this.collisionGrid),this.stats.addStats(`Solver object: ${t.toString()}`)}))}applyForces(){this.objects.forEach((t=>{const e=k.diff(t.currentPosition,this.gravityCenter);t.accelerate(e.ort.mul(-this.gravity.length))}))}processCollisionsInCell(t,e){this.stats.addStats("processCollisionsInCell.calls"),e.objects.forEach((e=>{t!==e&&(t.immovable&&e.immovable||(this.stats.addStats("processCollisions.calls"),t.collide(e)))}))}processCell(t){this.stats.addStats("processCell.calls",1);const e=this.collisionGrid.cells[t];e.objects.forEach((s=>{this.collisionGrid.adjacentCells[t].forEach((t=>{t===e&&1===t.objects.length||this.processCollisionsInCell(s,t)}))}))}processCollisions(){for(let t=0;t<this.collisionGrid.size;t++)this.processCell(t)}debugRender(t){this.collisionGrid.debugRender(t),this.objects.forEach((e=>e.debugRender(t)))}constructor(t,e){super(t,e),this.gravity=B.Zero(),this.gravityCenter=B.Zero(),this.configure()}}class D{constructor(t){this.engine=t}}class L{getNextObjects(t){return[]}constructor(t){this.solver=null,this.solver=t}}class V extends L{getNextObjects(t){if(this.total>this.limit)return[];if(this.lastCreateTime+=1,this.lastCreateTime>this.delay){const t=this.create(this.total);return this.lastCreateTime=0,this.total+=t.length,t}return[]}constructor(t,e,s,i){super(t),this.limit=e,this.total=0,this.delay=s,this.create=i,this.lastCreateTime=0}}class N{render(){}queue(){}constructor(t,e){this.position=B.Zero(),this.renderer=t,this.position=e}}class X extends N{render(){this.renderer.strokeStyle(this.color),this.renderer.fillStyle(this.color),this.renderer.fillCircle(this.r,this.position)}constructor(t,e,s,i){super(t,e),this.r=0,this.color="#00ff00",s&&(this.r=s),i&&(this.color=i)}}class Z{inBetween(t){const e=k.diff(t,this._vec1).length+k.diff(this._vec2,t).length;return s=this._length,i=e,n=R,Math.abs(s-i)<n;var s,i,n}inBetweenFast(t){return t.isInsideRect(this._vec1,this._vec2)}calculateKB(){this._vec1.y===this._vec2.y?(this._b=this._vec1.y,this._k=0):this._vec1.x===this._vec2.x?(this._b=NaN,this._k=NaN):(this._b=(this._vec1.x*this._vec2.y-this._vec1.y*this._vec2.x)/(this._vec1.x-this._vec2.x),this._k=(this._vec1.y-this._vec2.y)/(this._vec1.x-this._vec2.x))}makeVec2FromX(t){return new B(t,this._k*t+this._b)}copy(){return new Z(this._vec1,this._vec2)}moveBy(t){return this._vec1.addSelf(t),this._vec2.addSelf(t),this.calculateKB(),this}getPointProjection(t){const e=this.direction,s=k.diff(t,this._vec1),i=k.dot(e,s)/this.length;return this._vec1.sum(this.ort.mul(i))}get B(){return this._b}get K(){return this._k}get length(){return this._length}get direction(){return this._direction}get ort(){return this._ort}get vec1(){return this._vec1}get vec2(){return this._vec2}get normal(){return this._vec2.diff(this._vec1).perpendicular}static Vertical(t){return new Z(new B(t,0),new B(t,Number.MAX_SAFE_INTEGER))}static Horizontal(t){return new Z(new B(0,t),new B(Number.MAX_SAFE_INTEGER,t))}constructor(t,e){this._vec1=B.Zero(),this._vec2=B.Zero(),this._k=0,this._b=0,this._vec1=t.copy(),this._vec2=e.copy(),this._direction=k.diff(this._vec1,this._vec2),this._length=this._direction.length,this._length2=this._direction.length2,this._ort=this._direction.ort,this.calculateKB()}}var A,G;function Y(t,e,s){try{const i=e.getPointProjection(t.currentPosition);if(e.inBetweenFast(i)){const n=k.diff(i,t.currentPosition);if(n.length2<t.radius2){const i=n.ort,o=(i.dot(e.normal)>0?1:-1)*(t.radius-n.length);t.moveBy(k.mul(i,-o*t.bounceValue*s))}}}catch(t){}}function U(t,e){let s=t,i=e;if(s.type>i.type){const t=function(t,e){return{a:e,b:t}}(s,i);s=t.a,i=t.b}switch(!0){case s.type===A.TypeBall&&i.type===A.TypeBall:return function(t,e){if(!t.getBoundary().intersect(e.getBoundary()))return;const s=k.diff(t.currentPosition,e.currentPosition),i=s.length,n=t.radius+e.radius;if(i<n){const o=s.ort,r=n-i;t.moveBy(k.mul(o,t.radius/n*r*t.bounceValue)),e.moveBy(k.mul(o,-e.radius/n*r*e.bounceValue))}}(s,i);case s.type===A.TypeBall&&i.type===A.TypeImmovableBall:return function(t,e){if(!t.getBoundary().intersect(e.getBoundary()))return;const s=k.diff(t.currentPosition,e.currentPosition),i=s.length,n=t.radius+e.radius;if(i<n){const o=s.ort,r=n-i;t.moveBy(k.mul(o,t.radius/n*r*t.bounceValue*e.bounceValue))}}(s,i);case s.type===A.TypeBall&&i.type===A.TypeImmovableLine:return o=i,void((n=s).getBoundary().intersect(o.getCollisionRange())&&Y(n,o._line,o.bounceValue));case s.type===A.TypeBall&&i.type===A.TypeImmovablePolygon:return function(t,e){t.getBoundary().intersect(e.getCollisionRange())&&e.lines.forEach((e=>Y(t,e._line,e.bounceValue)))}(s,i);default:return}var n,o}(G=A||(A={}))[G.TypeNull=0]="TypeNull",G[G.TypeBall=1]="TypeBall",G[G.TypeImmovableBall=2]="TypeImmovableBall",G[G.TypeImmovableLine=3]="TypeImmovableLine",G[G.TypeImmovablePolygon=4]="TypeImmovablePolygon";class H{update(t){}accelerate(t){}collide(t){}inside(t){return this.currentPosition.x>=t.left&&this.currentPosition.x<=t.right&&this.currentPosition.y>=t.top&&this.currentPosition.y<=t.bottom}debugRender(t){}toString(){return"BaseSolverObject"}constructor(){this.type=A.TypeNull,this.previousPosition=B.Zero(),this.currentPosition=B.Zero(),H.index+=1,this.index=H.index}}H.index=0;class ${recalculate(){this._width2=this.size.x/2,this._height2=this.size.y/2,this._left=this.position.x-this._width2,this._right=this.position.x+this._width2,this._top=this.position.y-this._height2,this._bottom=this.position.y+this._height2}copy(){return new $(this.position,this.size)}intersect(t){return!(this.left>t.right||this.right<t.left||this.top>t.bottom||this.bottom<t.top)}contains(t){return t.x>this.left&&t.x<this.right&&t.y>this.top&&t.y<this.bottom}moveBy(t){this.position.addSelf(t),this.recalculate()}moveTo(t){this.position=t.copy(),this.recalculate()}get nw(){return new $(new B(this.position.x-this._width2/2,this.position.y-this._height2/2),new B(this._width2,this._height2))}get ne(){return new $(new B(this.position.x+this._width2/2,this.position.y-this._height2/2),new B(this._width2,this._height2))}get se(){return new $(new B(this.position.x+this._width2/2,this.position.y+this._height2/2),new B(this._width2,this._height2))}get sw(){return new $(new B(this.position.x-this._width2/2,this.position.y+this._height2/2),new B(this._width2,this._height2))}get left(){return this._left}get right(){return this._right}get top(){return this._top}get bottom(){return this._bottom}get diag(){return this.size.length}get width(){return this.size.x}get height(){return this.size.y}constructor(t,e){if(this.position=t.copy(),this.size=e.copy(),this.size.x<0||this.size.y<0)throw new C;this.recalculate()}}const q=Math.pow(10,2);class K extends H{update(t){let e=this.velocity.mul(this.motionReduce);e.length2>q&&(e=e.ort.mul(10)),this.previousPosition=this.currentPosition.copy(),this.moveBy(e.addSelf(this.acc.mul(t*t))),this.acc=B.Zero()}accelerate(t){return this.acc.addSelf(t),this}setVelocity(t){return this.velocity=t,this}collide(t){U(this,t)}addToSpace(t){t.addPointObject(Math.floor(this.currentPosition.x),Math.floor(this.currentPosition.y),this)}moveBy(t){this.currentPosition.moveBy(t),this.collisionRange.moveBy(t),this.boundary.moveBy(t)}moveTo(t){this.currentPosition.moveTo(t),this.collisionRange.moveTo(this.currentPosition),this.boundary.moveTo(this.currentPosition)}isPointInsideObject(t){return k.distance(this.currentPosition,t)<this.radius}get velocity(){return k.diff(this.currentPosition,this.previousPosition)}set velocity(t){this.previousPosition=k.diff(this.currentPosition,t)}get movementVector(){return new Z(this.previousPosition,this.currentPosition)}get radius2(){return this._radius2}intersects(t){return new $(this.currentPosition,new B(this.radius,this.radius)).intersect(t)}getCollisionRange(){return this.collisionRange}getBoundary(){return this.boundary}debugRender(t){t.strokeStyle("#FF0000");const e=this.getCollisionRange();t.rect(e.left,e.top,e.width,e.height)}constructor(t,e){super(),this.acc=B.Zero(),this.radius=10,this.bounceValue=1.1,this.motionReduce=.999,this.type=A.TypeBall,this.immovable=!1,this.previousPosition=t.copy(),this.currentPosition=t.copy(),void 0!==e&&(this.radius=e),this._radius2=this.radius*this.radius,this.collisionRange=new $(this.currentPosition,new B(4*this.radius)),this.boundary=new $(this.currentPosition,new B(2*this.radius))}}class W{update(){this.renderItem.position=this.solverObject.currentPosition}render(){this.update(),this.renderItem.render()}constructor(t,e){this.solverObject=null,this.renderItem=null,this.solverObject=t,this.renderItem=e}}class J extends K{update(t){this.currentPosition=this._fixedPosition,this.previousPosition=this._fixedPosition,this.collisionRange.moveTo(this.currentPosition)}addToSpace(t){const e=new B(this.radius*I,this.radius*I),s=this.currentPosition.sum(e),i=this.currentPosition.diff(e);t.addRectangularObject(s,i,this)}moveTo(t){this.currentPosition=t.copy(),this.previousPosition=t.copy(),this._fixedPosition=t.copy(),super.moveTo(t)}constructor(t,e){super(t,e),this.type=A.TypeImmovableBall,this.immovable=!0,this.bounceValue=.5,this._fixedPosition=null,this._fixedPosition=t.copy()}}class Q extends W{update(){super.update(),this.renderItem.direction=this.solverObject._direction}constructor(t,e){var s,i,n;super(t),n=null,(i="solverObject")in(s=this)?Object.defineProperty(s,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[i]=n,this.solverObject=t,this.renderItem=e}}class tt extends H{}class et extends tt{update(t){this.currentPosition=this._line.vec1,this.previousPosition=this._line.vec2}addToSpace(t){t.addRectangularObject(this._line.vec1,this._line.vec2,this)}moveBy(t){this.currentPosition.addSelf(t),this.previousPosition.addSelf(t),this._line.moveBy(t),this.collisionRange=new $(this.currentPosition.sum(this._direction.mul(.5)),this._direction.abs)}moveTo(t){const e=k.diff(t,this._line.vec1);this.moveBy(e)}debugRender(t){t.strokeStyle("#00FF00"),t.line(this._line.vec1,this._line.vec2),t.text(`${this.index}`,this._line.vec1),t.strokeStyle("#FFFFFF"),t.lineWidth(10);const e=this.currentPosition.sum(this._line.normal.flipSelf().mul(100));t.line(this.currentPosition.x,this.currentPosition.y,e.x,e.y),t.lineWidth(1),t.strokeStyle("#FF0000"),t.rect(this.collisionRange.left,this.collisionRange.top,this.collisionRange.width,this.collisionRange.height)}toString(){return"ImmovableLine"}inside(t){return t.intersect(this.collisionRange)}intersects(t){return!!t.intersect(this.collisionRange)&&(!(!t.contains(this._line.vec1)&&!t.contains(this._line.vec2))||(this.collisionRange.top<t.top&&this.collisionRange.bottom>t.top||(this.collisionRange.top<t.bottom&&this.collisionRange.bottom>t.bottom||(this.collisionRange.left<t.left&&this.collisionRange.right>t.left||(this.collisionRange.left<t.right&&this.collisionRange.right>t.right||void 0)))))}isPointInsideObject(t){return!1}getCollisionRange(){return this.collisionRange}constructor(t,e){super(),this.type=A.TypeImmovableLine,this.immovable=!0,this.bounceValue=1,t instanceof Z?(this.currentPosition=t.vec1.copy(),this.previousPosition=t.vec1.copy(),this._direction=t.direction.copy().flipSelf()):(this.currentPosition=t.copy(),this.previousPosition=t.copy(),this._direction=e),this._line=new Z(this.currentPosition.copy(),this.currentPosition.copy().sum(this._direction)),this.collisionRange=new $(this.currentPosition.sum(this._direction.mul(.5)),this._direction.abs)}}function st(t,e){return new et(t,k.diff(e,t))}class it extends N{render(){this.renderer.strokeStyle(this.color),this.renderer.vector(this.position,this.direction)}constructor(t,e,s,i){super(t,e),this.direction=B.Zero(),this.color="#00ff00",this.direction=s,i&&(this.color=i)}}class nt extends X{render(){super.render(),""!==this.text&&(this.renderer.fillStyle(this.textColor),this.renderer.text(this.text,this.position))}constructor(t,e,s,i,n,o){super(t,e,s,i),this.text="",this.textColor="#ffffff",this.text=n,o&&(this.textColor=o)}}function ot(t){const e=.005;return`rgba(${Math.floor(127*Math.sin(e*t+0)+128)}, ${Math.floor(127*Math.sin(e*t+2)+128)}, ${Math.floor(127*Math.sin(e*t+4)+128)}, 1)`}class rt{constructor(){}}class ht extends rt{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}applyConstrain(t){const e=t.currentPosition.copy();let s=!1;t.currentPosition.x-t.radius<0?(e.x=t.radius,s=!0):t.currentPosition.x+t.radius>this._width&&(e.x=this._width-t.radius,s=!0),t.currentPosition.y-t.radius<0?(e.y=t.radius,s=!0):t.currentPosition.y+t.radius>this._height&&(e.y=this._height-t.radius,s=!0),s&&t.moveTo(e)}constructor(t,e){super(),this._width=0,this._height=0,this.width=t,this.height=e}}const ct=[new B(0,0),new B(70,380),new B(270,380),new B(340,0),new B(360,0),new B(280,400),new B(60,400),new B(-20,0)];function at(t,e){const s=e.diff(new B(180*t,200*t)),i=[];for(let e=0;e<ct.length-1;e++)i.push(new Z(ct[e].mul(t).sum(s),ct[e+1].mul(t).sum(s)));return i.push(new Z(ct[ct.length-1].mul(t).sum(s),ct[0].mul(t).sum(s))),i}class lt extends rt{applyConstrain(t){const e=t.currentPosition.diff(this.center),s=e.length,i=t.radius||0;if(s>this.radius-i){const s=e.ort;t.moveTo(this.center.sum(s.mul(this.radius-i)))}}constructor(t,e){super(),this.center=B.Zero(),this.radius=0,this.center=t,this.radius=e}}function dt(t){const e=t*Math.sqrt(3)/2,s=new B(t/2,t/2*(1/Math.sqrt(3)));return[new B(-s.x,-s.y),new B(0,e-s.y),new B(s.x,-s.y)]}class ut extends tt{_recreateLines(){const t=[...this._localPoints].reverse();let e,s=t.shift(),i=s;for(this._lines.splice(0,this._lines.length);e=t.shift();){const t=st(this._fixedPosition.sum(i),this._fixedPosition.sum(e));this._lines.push(t),i=e}const n=st(this._fixedPosition.sum(i),this._fixedPosition.sum(s));this._lines.push(n)}update(t){this.currentPosition=this._fixedPosition,this.previousPosition=this._fixedPosition}addToSpace(t){try{this._lines.forEach((e=>e.addToSpace(t)))}catch(t){console.log(t,this._lines)}}isPointInsideObject(t){return!0}moveBy(t){this._fixedPosition.addSelf(t),this._lines.forEach((e=>e.moveBy(t)))}moveTo(t){const e=k.diff(t,this._fixedPosition);this.moveBy(e)}toString(){return"ImmovablePolygon"}debugRender(t){t.strokeStyle("#00FF00"),this._lines.forEach((e=>e.debugRender(t)))}get lines(){return this._lines}intersects(t){return this._lines.some((e=>e.intersects(t)))}getCollisionRange(){return new $(this.currentPosition,new B(60,60))}constructor(t,e){super(),this._localPoints=[],this._lines=[],this.type=A.TypeImmovablePolygon,this.immovable=!0,this.bounceValue=1,this.currentPosition=t.copy(),this.previousPosition=t.copy(),this._fixedPosition=t.copy(),e.forEach((t=>{this._localPoints.push(t.copy())})),this._recreateLines()}}class gt extends N{render(){this.renderer.strokeStyle(this.color),this.renderer.polygon(this.points.map((t=>t.sum(this.position))))}constructor(t,e,s,i){super(t,e),this.direction=B.Zero(),this.color="#00ff00",this.points=s,i&&(this.color=i)}}class ft extends gt{}const pt={scene1:class extends D{createBallsGenerator(t,e,s){const i=t.diff(e),n=s.mul(1/this.engine.solver.subSteps);return new V(this.engine.solver,1e3,7,(t=>[new W(new K(i,5).setVelocity(n),new nt(this.engine.context,B.Zero(),5,ot(t+200),"","#000000")),new W(new K(i.sum(B.Down(20)),5).setVelocity(n),new nt(this.engine.context,B.Zero(),5,ot(t+100),"","#000000")),new W(new K(i.sum(B.Down(-20)),5).setVelocity(n),new nt(this.engine.context,B.Zero(),5,ot(t),"","#000000")),new W(new K(i.sum(B.Right(-40)),5).setVelocity(n),new nt(this.engine.context,B.Zero(),5,ot(t-100),"","#000000"))]))}createBottomBouncyLine(){const t=new et(new B(0,this.engine.canvas.height-10),new B(this.engine.canvas.width,0));t.bounceValue=1.5,this.engine.addObject(new Q(t,new it(this.engine.context,B.Zero(),B.Zero(),"#ff0000")))}createMilkShake(t){at(1,t).forEach((t=>{this.engine.addObject(new Q(new et(t),new it(this.engine.context,B.Zero(),B.Zero(),"#ffffff")))})),at(.5,t).forEach((t=>{this.engine.addObject(new Q(new et(t),new it(this.engine.context,B.Zero(),B.Zero(),"#0000ff")))}))}initConstrain(){this.engine.constrain=new ht(this.engine.canvas.width,this.engine.canvas.height)}createActor(){this.actor=new W(new J(new B(230,50),30),new X(this.engine.context,B.Zero(),30,"#ff0000")),this.engine.addObject(this.actor)}getActor(){return this.actor}tick(t){if(this.engine.stats.addStats("Time passed",t),t>.017)return;const e=this.generator.getNextObjects(t);e&&e.forEach((t=>this.engine.addObject(t)))}processUserInput(t){const e=t;e.leftButtonDown?(this.actor.solverObject.isPointInsideObject(new B(e.screenX,e.screenY))&&(this.canMoveRedObject=!0),this.canMoveRedObject&&this.actor.solverObject.moveBy(new B(e.dx,e.dy))):this.canMoveRedObject=!1}constructor(t){super(t),this.canMoveRedObject=!1;const e=new B(this.engine.canvas.width/2,this.engine.canvas.height/2);this.generator=this.createBallsGenerator(e,new B(300,300),new B(2,-2)),this.createBottomBouncyLine(),this.createMilkShake(e),this.createActor(),this.initConstrain()}},scene2:class extends D{createBall(){new B(0,0);const t=this.actor.solverObject.currentPosition,e=t.diff(this.center).ort,s=e.mul(-1),i=new W(new K(t.diff(e.mul(40)),5).setVelocity(s),new nt(this.engine.context,B.Zero(),7,ot(this.ballIndex+200),"","#000000"));this.engine.addObject(i),this.ballIndex++}createActor(){this.actor=new W(new J(new B(230,50),30),new X(this.engine.context,B.Zero(),30,"#ff0000")),this.engine.addObject(this.actor)}initConstrain(){this.engine.constrain=new lt(this.center,this.radius),this.engine.items.push(new X(this.engine.context,this.center,this.radius,"#ffffff"))}getActor(){return this.actor}tick(t){this.canMoveRedObject&&(this.timePassedSinceLastBallCreated+=t,this.timePassedSinceLastBallCreated>.05&&(this.timePassedSinceLastBallCreated=0,this.createBall()))}processUserInput(t){const e=t;e.leftButtonDown?(this.actor.solverObject.isPointInsideObject(new B(e.screenX,e.screenY))&&(this.canMoveRedObject=!0),this.canMoveRedObject):this.canMoveRedObject=!1,(e.screenX||e.screenY)&&this.actor.solverObject.moveTo(new B(e.screenX,e.screenY))}set canMoveRedObject(t){this._canMoveRedObject=t,this.actor.renderItem.color=t?"#00ff00":"#ff0000"}get canMoveRedObject(){return this._canMoveRedObject}constructor(t){super(t),this._canMoveRedObject=!1,this.timePassedSinceLastBallCreated=0,this.ballIndex=0,this.center=new B(this.engine.canvas.width/2,this.engine.canvas.height/2),this.radius=Math.min(this.center.x,this.center.y),this.generator=new L(this.engine.solver),this.createActor(),this.initConstrain()}},scene3:class extends D{createBall(){new B(0,0);const t=this.actor.solverObject.currentPosition,e=t.diff(this.center).ort,s=e.mul(-1),i=20+30*Math.random(),n=new nt(this.engine.context,B.Zero(),i,ot(this.ballIndex+200),"","#000000");this.ballsViews.push(n);const o=new W(new K(t.diff(e.mul(40)),i).setVelocity(s),n);this.engine.addObject(o),this.ballIndex++}createActor(){const t=dt(60);this.nextTickActorPosition=this.center;const e=new ut(this.center,t),s=new ft(this.engine.context,B.Zero(),t,"#ff0000");this.actor=new W(e,s),this.engine.addObject(this.actor)}initConstrain(){this.engine.constrain=new lt(this.center,this.radius),this.engine.items.push(new X(this.engine.context,this.center,this.radius,"#555555"))}getActor(){return this.actor}tick(t){this.actor.solverObject.moveTo(this.nextTickActorPosition),this.createBalls&&(this.timePassedSinceLastBallCreated+=t,this.timePassedSinceLastBallCreated>.05&&(this.timePassedSinceLastBallCreated=0,this.createBall())),this.ballsViews.forEach((t=>{t.color=ot(t.position.y)}))}processUserInput(t){const e=t;e.leftButtonDown?this.actor.solverObject.isPointInsideObject(new B(e.screenX,e.screenY))&&(this.createBalls=!0):this.createBalls=!1,(e.screenX||e.screenY)&&(this.nextTickActorPosition=new B(e.screenX,e.screenY))}set createBalls(t){this._createBalls=t,this.actor.renderItem.color=t?"#00ff00":"#ff0000"}get createBalls(){return this._createBalls}constructor(t){super(t),this._createBalls=!1,this.timePassedSinceLastBallCreated=0,this.ballIndex=0,this.ballsViews=[],this.center=new B(this.engine.canvas.width/2,this.engine.canvas.height/2),this.radius=Math.min(this.center.x,this.center.y),this.generator=new L(this.engine.solver),this.createActor(),this.initConstrain()}}};class vt{resetTick(){this.tickData.forEach(((t,e)=>this.tickData[e]=0))}writeStats(t,e){const s=this.registerKey(t);this.tickData[s]=e,this.totalData[s]=e}addStats(t,e=1){const s=this.registerKey(t);this.tickData[s]+=e,this.totalData[s]+=e}registerKey(t){return this.keys.has(t)?this.keys.get(t):(this.tickData.push(0),this.totalData.push(0),this.keys.set(t,this.tickData.length-1),this.tickData.length-1)}getStats(t){if(!this.keys.has(t))return{key:t,total:0,tick:0};const e=this.keys.get(t);return{key:t,total:this.totalData[e],tick:this.tickData[e]}}getTickData(){const t=[];return this.keys.forEach(((e,s)=>{t.push({key:s,value:this.tickData[e]})})),t}constructor(){this.tickData=[],this.totalData=[],this.keys=new Map}}class yt{clear(){this.objects.length>0&&this.objects.splice(0),this.divided&&this.nodes.forEach((t=>t.clear())),this.divided=!1}get canSubdivide(){return this.boundary.diag>this.minimumDiag}insert(t){if(!t.inside(this.boundary))return;if(this.objects.length<this.capacity)return this.objects.push(t),!0;if(!this.canSubdivide)return this.objects.push(t),!0;this.divided||(this.subdivide(),this.divided=!0);let e=0;for(;e<4;)this.nodes[e].insert(t)&&(e=5),e++;return 5===e}subdivide(){this.nodes[yt.NW]=new yt(this.boundary.nw,this.capacity),this.nodes[yt.NE]=new yt(this.boundary.ne,this.capacity),this.nodes[yt.SE]=new yt(this.boundary.se,this.capacity),this.nodes[yt.SW]=new yt(this.boundary.sw,this.capacity)}query(t){let e=[];return this.boundary.intersect(t)?(this.objects.forEach((s=>{s.intersects(t)&&e.push(s)})),this.divided&&this.nodes.forEach((s=>s.query(t).forEach((t=>e.push(t))))),e):e}debugRender(t){t.strokeStyle(this.objects.length>0?"#ff0000":"#00ff00"),t.rect(this.boundary.left,this.boundary.top,this.boundary.width-2,this.boundary.height-2),this.divided&&this.nodes.forEach((e=>e.debugRender(t)))}constructor(t,e){this.divided=!1,this.minimumDiag=10,this.boundary=t.copy(),this.capacity=e,this.objects=[],this.nodes=[],this.divided=!1}}yt.NW=0,yt.NE=1,yt.SE=2,yt.SW=3;class xt extends T{clear(){this.root.clear()}addObject(t){this.root.insert(t)}addPointObject(t,e,s){this.root.insert(s)}addRectangularObject(t,e,s){this.root.insert(s)}debugRender(t){this.root.debugRender(t)}constructor(t,e){super(),this.root=new yt(new $(new B(t/2,e/2),new B(t,e)),4)}}class mt extends F{reset(){super.reset(),this.space.clear()}configure(){super.configure(),this.gravity=new B(0,100),this.space=new xt(this.worldSize.x,this.worldSize.y)}processOptimizations(){this.space.clear(),this.objects.forEach(((t,e)=>{t.addToSpace(this.space),this.stats.addStats(`Solver object: ${t.toString()}`)}))}applyForces(){this.objects.forEach((t=>t.accelerate(this.gravity)))}processCollisions(){this.objects.forEach((t=>{const e=t.getCollisionRange(),s=this.space.root.query(e);this.stats.addStats("processCollisions.queryPossibleObjects.calls"),s.forEach((e=>{t!==e&&(t.immovable&&e.immovable||(this.stats.addStats("processCollisions.calls"),t.collide(e)))}))}))}debugRender(t){this.space.debugRender(t),this.objects.forEach((e=>e.debugRender(t)))}constructor(t,e){super(t,e),this.gravity=B.Zero(),this.configure()}}class _t{moveTo(t,e){this._position.moveTo(t,e)}constructor(){this._position=B.Zero()}}class wt extends _t{getCoord(t,e){let s,i;return void 0===t?(s=this._position.x,i=this._position.y):t instanceof B?(s=t.x,i=t.y):(s=t,i=e),[s,i]}circle(t,e,s){const[i,n]=this.getCoord(e,s);this._context.beginPath(),this._context.arc(i,n,t,0,2*Math.PI),this._context.stroke()}fillCircle(t,e,s){const[i,n]=this.getCoord(e,s);this._context.beginPath(),this._context.arc(i,n,t,0,2*Math.PI),this._context.fill()}color(){}fillStyle(t){this._context.fillStyle=t}fillRect(t,e,s,i){this._context.fillRect(t,e,s-t,i-e)}line(t,e,s,i){e instanceof B?([t,e]=this.getCoord(t),[s,i]=this.getCoord(e)):[t,e]=this.getCoord(t,e),this._context.beginPath(),this._context.moveTo(t,e),this._context.lineTo(s,i),this._context.stroke()}vector(t,e){this._context.beginPath(),this._context.moveTo(t.x,t.y),this._context.lineTo(t.x+e.x,t.y+e.y),this._context.stroke()}rect(t,e,s,i){this._context.strokeRect(t,e,s,i)}text(t,e,s){const[i,n]=this.getCoord(e,s);this._context.fillStyle="#ffffff",this._context.textAlign="start",this._context.fillText(t,i,n)}moveTo(){}font(t){this._context.font=t}lineTo(t,e){const[s,i]=this.getCoord(t,e);this._context.moveTo(this._position.x,this._position.y),this._context.lineTo(s,i)}strokeStyle(t){this._context.strokeStyle=t}lineWidth(t){this._context.lineWidth=t}polygon(t){this._context.beginPath();let e=0;for(this._context.moveTo(t[e].x,t[e].y);e<t.length-1;)e++,this._context.lineTo(t[e].x,t[e].y);this._context.lineTo(t[0].x,t[0].y),this._context.stroke()}constructor(t){super(),this._context=t}}class bt{reset(){this.objects=[],this.items=[],this.solver.reset()}switchToGridSolver(){const t=new z(new B(this.canvas.width,this.canvas.height),this.stats);this.solver&&(this.solver.objects.forEach((e=>t.addObject(e))),t.constrains=this._constrains),this.solver=t}switchToQuadSolver(){const t=new mt(new B(this.canvas.width,this.canvas.height),this.stats);this.solver&&(this.solver.objects.forEach((e=>t.addObject(e))),t.constrains=this._constrains),this.solver=t}configure(){this.switchToGridSolver(),this.context.font("10px serif"),this.loadScene("scene1")}processUserInput(t){const e=t;"g"===e.keyPressed&&(this.flagRenderGrid=!this.flagRenderGrid),"p"===e.keyPressed&&(this.flagRenderPreviousPosition=!this.flagRenderPreviousPosition),"s"===e.keyPressed&&(this.flagSwitchSolver=!0),this.scene.processUserInput(t)}processEngineEvent(t){const e=t;e.scene&&this.loadScene(e.scene)}loadScene(t){this.reset();const e=pt[t];this.scene=new e(this)}addObject(t){this.objects.push(t),this.solver.addObject(t.solverObject)}update(t){this.solver.update(t)}tick(){this.step<0&&(this.step=0);const t=this.step/1e3;this.scene.tick(t),this.update(t),this.clear(),this.renderItems(),this.flagRenderGrid&&this.renderGrid(),this.flagRenderPreviousPosition&&this.renderPreviousPosition(),this.printFPS(),this.stats.resetTick(),B.lengthCallsCount=0,B.length2CallsCount=0,this.flagSwitchSolver&&(this.solver instanceof z?this.switchToQuadSolver():this.switchToGridSolver(),this.flagSwitchSolver=!1)}renderItems(){this.items.forEach((t=>t.render())),this.objects.forEach((t=>t.render()))}printFPS(){this.context.fillStyle("rgba(0,0,0,0.1)"),this.context.fillRect(0,0,100,60),this.context.text(`${Math.round(this.step)} ms / ${Math.round(1e3/this.step)} FPS`,0,10),this.context.text(`Length calls: ${B.lengthCallsCount}`,0,20),this.context.text(`Lenght2 calls: ${B.length2CallsCount}`,0,30),this.context.text(`Objects: ${this.objects.length}`,0,40),this.context.text(`Compares per object: ${Math.round(B.lengthCallsCount/this.objects.length)}`,0,50);this.stats.getTickData().forEach(((t,e)=>{this.context.text(`${t.key}: ${t.value}`,0,10*e+60)}))}clear(){this.context.fillStyle("rgba(0, 0, 0, 0.9)"),this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}start(){self.requestAnimationFrame?self.requestAnimationFrame(this.nextFrame):setInterval(this.nextInterval,16)}renderGrid(){this.solver.debugRender(this.context)}renderPreviousPosition(){this.objects.forEach((t=>{const e=t.solverObject.previousPosition;this.context.fillStyle("rgba(0, 0, 255, 0.5)"),this.context.fillCircle(10,e)}))}set constrain(t){this._constrains=t,this.solver.constrains=this._constrains}get constrain(){return this._constrains}constructor(t){this.objects=[],this._constrains=null,this.solver=null,this.flagRenderGrid=!1,this.flagRenderPreviousPosition=!1,this.flagSwitchSolver=!1,this.nextFrame=t=>{this.step=t-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=t,self.requestAnimationFrame(this.nextFrame)},this.nextInterval=()=>{this.timeRenderStart=performance.now(),this.step=this.timeRenderStart-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=performance.now()},this.stats=new vt,this.canvas=t,this.context=new wt(this.canvas.getContext("2d")),this.timeRenderStart=performance.now(),this.timeRenderEnd=performance.now(),this.step=0,this.objects=[],this.items=[],this.solver=null,this.configure()}}class St extends b{constructor(t){super(),this.sendUserInputEvent=t=>{this.render.processUserInput(t)},this.sendEngineEvent=t=>{this.render.processEngineEvent(t)},this.render=new bt(t),this.render.start(),this.userInput=new c(t),this.userInput.addHandler(this.sendUserInputEvent)}}var Pt;Pt=function(){console.log("Init application");const t=h("#image_canvas"),e=h("#container");let s;t.width=e.offsetWidth,t.height=e.offsetHeight,t.transferControlToOffscreen?(console.log("Render in worker"),s=new S(t)):(console.log("Render in main thread"),s=new St(t));const i=h("#scene1"),n=h("#scene2"),o=h("#scene3");i.addEventListener("click",(t=>{t.preventDefault(),s.loadScene("scene1")})),n.addEventListener("click",(t=>{t.preventDefault(),s.loadScene("scene2")})),o.addEventListener("click",(t=>{t.preventDefault(),s.loadScene("scene3")}))},document.readyState!==o?Pt():document.addEventListener("DOMContentLoaded",Pt)}();