!function(){function t(t,i,e,s){Object.defineProperty(t,i,{get:e,set:s,enumerable:!0,configurable:!0})}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},s={},n=i.parcelRequire62ee;null==n&&((n=function(t){if(t in e)return e[t].exports;if(t in s){var i=s[t];delete s[t];var n={id:t,exports:{}};return e[t]=n,i.call(n.exports,n,n.exports),n.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,i){s[t]=i},i.parcelRequire62ee=n),n.register("iE7OH",(function(i,e){var s,n;t(i.exports,"register",(function(){return s}),(function(t){return s=t})),t(i.exports,"resolve",(function(){return n}),(function(t){return n=t}));var r={};s=function(t){for(var i=Object.keys(t),e=0;e<i.length;e++)r[i[e]]=t[i[e]]},n=function(t){var i=r[t];if(null==i)throw new Error("Could not resolve bundle with id "+t);return i}})),n("iE7OH").register(JSON.parse('{"5d7Nu":"index.5ed5374c.js","gVigP":"main.4487a6d6.js"}'));const r="loading";class o extends Error{}function h(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}const c=1e-6;class a extends Error{}class u{add(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return this.x-=t.x,this.y-=t.y,this}flipY(){return this.y=-this.y,this}flipX(){return this.x=-this.x,this}flip(){return this.x=-this.x,this.y=-this.y,this}equals(t){return f.distance(this,t)<c}sum(t){return new u(this.x+t.x,this.y+t.y)}diff(t){return new u(this.x-t.x,this.y-t.y)}mul(t){return new u(this.x*t,this.y*t)}copy(){return new u(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get normalized(){const t=this.length;return new u(this.x/t,this.y/t)}get perpendicular(){if(0===this.x){if(this.y>0)return u.Horizontal().normalized;if(this.y<0)return u.Horizontal().normalized.flip();throw new a}if(0===this.y){if(this.x>0)return u.Vertical().normalized;if(this.x<0)return u.Vertical().normalized.flip()}return new u(-this.y/this.x,1).normalized}static Zero(){return new u(0,0)}static Horizontal(){return new u(1,0)}static Vertical(){return new u(0,1)}constructor(t,i){h(this,"x",0),h(this,"y",0),this.x=t,this.y=i}}class l{inBetween(t){const i=f.diff(t,this._vec1).length,e=f.diff(this._vec2,t).length,s=f.diff(this._vec1,this._vec2).length;return n=s,r=i+e,o=c,Math.abs(n-r)<o;var n,r,o}calculateKB(){this._vec1.y===this._vec2.y?(this.b=this._vec1.y,this.k=0):this._vec1.x===this._vec2.x?(this.b=NaN,this.k=NaN):(this.b=(this._vec1.x*this._vec2.y-this._vec1.y*this._vec2.x)/(this._vec1.x-this._vec2.x),this.k=(this._vec1.y-this._vec2.y)/(this._vec1.x-this._vec2.x))}makeVec2FromX(t){return new u(t,this.k*t+this.b)}copy(){return new l(this._vec1,this._vec2)}moveBy(t){this._vec1.add(t),this._vec2.add(t),this.calculateKB()}getPointProjection(t){const i=this.direction,e=f.diff(t,this._vec1),s=(e.length,f.dot(i,e)/this.length);return this._vec1.sum(this.ort.copy().mul(s))}get B(){return this.b}get K(){return this.k}get length(){return this._length}get direction(){return this._direction}get ort(){return this._normalized}get vec1(){return this._vec1}get vec2(){return this._vec2}static Vertical(t){return new l(new u(t,0),new u(t,Number.MAX_SAFE_INTEGER))}static Horizontal(t){return new l(new u(0,t),new u(Number.MAX_SAFE_INTEGER,t))}constructor(t,i){h(this,"_vec1",u.Zero()),h(this,"_vec2",u.Zero()),h(this,"_direction",null),h(this,"_length",0),h(this,"k",0),h(this,"b",0),this._vec1=t,this._vec2=i,this._direction=f.diff(this._vec1,this._vec2),this._length=this._direction.length,this._normalized=this._direction.normalized,this.calculateKB()}}class d extends Error{}class f{static diff(t,i){return new u(t.x-i.x,t.y-i.y)}static mul(t,i){return new u(t.x*i,t.y*i)}static distance(t,i){return f.diff(t,i).length}static intersect(t,i){if(t.K===i.K)throw new d;if(isNaN(t.K)||isNaN(i.K))return isNaN(t.K)?i.makeVec2FromX(t._vec1.x):t.makeVec2FromX(i._vec1.x);{const e=(t.B-i.B)/(i.K-t.K);return t.makeVec2FromX(e)}}static dot(t,i){return t.x*i.x+t.y*i.y}static mirror(t,i){const e=i.direction.perpendicular.normalized;return t.copy().sub(e.mul(2*f.dot(t,e)))}}class p{render(){}constructor(t,i){h(this,"position",u.Zero()),this.context=t,this.position=i}}class x extends p{render(){this.context.beginPath(),this.context.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),this.context.fillStyle=this.color,this.context.fill()}constructor(t,i,e,s){super(t,i),h(this,"r",0),h(this,"color","#00ff00"),e&&(this.r=e),s&&(this.color=s)}}const v=1,y=2,w=3;function m(t,i){switch(t.type>i.type&&([i,t]=[t,i]),!0){case t.type===v&&i.type===v:return function(t,i){const e=f.diff(t.currentPosition,i.currentPosition),s=e.length,n=t.radius+i.radius;if(s<n){const r=e.normalized,o=n-s;t.currentPosition.add(f.mul(r,t.radius/n*o*t.bounceValue)),i.currentPosition.sub(f.mul(r,i.radius/n*o*i.bounceValue))}}(t,i);case t.type===v&&i.type===y:return function(t,i){const e=f.diff(t.currentPosition,i.currentPosition),s=e.length,n=t.radius+i.radius;if(s<n){const i=e.normalized,r=n-s;t.currentPosition.add(f.mul(i,t.radius/n*r*t.bounceValue))}}(t,i);case t.type===v&&i.type===w:return function(t,i){try{const e=i._line.getPointProjection(t.currentPosition);if(i._line.inBetween(e)){const i=f.diff(e,t.currentPosition);if(i.length<t.radius){const e=i.normalized,s=t.radius-i.length;t.currentPosition.sub(f.mul(e,s*t.bounceValue))}}}catch(t){}}(t,i);default:return}}class g{update(t){const i=this.velocity;this.previousPosition=this.currentPosition.copy(),this.currentPosition.add(i.add(this.acc.mul(t*t))),this.acc=u.Zero()}accelerate(t){return this.acc.add(t),this}setVelocity(t){return this.velocity=t,this}collide(t){m(this,t)}flip(){const t=this.currentPosition.copy();this.currentPosition=this.previousPosition,this.previousPosition=t}get velocity(){return f.diff(this.currentPosition,this.previousPosition)}set velocity(t){this.previousPosition=f.diff(this.currentPosition,t)}get movementVector(){return new l(this.previousPosition,this.currentPosition)}constructor(t,i){h(this,"previousPosition",u.Zero()),h(this,"currentPosition",u.Zero()),h(this,"acc",u.Zero()),h(this,"radius",10),h(this,"bounceValue",1.1),h(this,"type",v),this.previousPosition=t.copy(),this.currentPosition=t.copy(),void 0!==i&&(this.radius=i)}}class b{applyConstrain(t){}constructor(){}}class _ extends b{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}applyConstrain(t){super.applyConstrain(t),t.currentPosition.x-t.radius<0&&(t.currentPosition.x=t.radius),t.currentPosition.x+t.radius>this._width&&(t.currentPosition.x=this._width-t.radius),t.currentPosition.y-t.radius<0&&(t.currentPosition.y=t.radius),t.currentPosition.y+t.radius>this._height&&(t.currentPosition.y=this._height-t.radius)}constructor(t,i){super(),h(this,"_width",0),h(this,"_height",0),this.width=t,this.height=i}}class P extends b{applyConstrain(t){super.applyConstrain(t);const i=t.currentPosition.diff(this.center),e=i.length,s=t.radius;if(e>this.radius-s){const e=i.normalized;t.currentPosition=this.center.sum(e.mul(this.radius-s))}}constructor(t,i){super(),h(this,"center",u.Zero()),h(this,"radius",0),this.center=t,this.radius=i}}class j{getNextObject(t){return null}constructor(t){h(this,"solver",null),this.solver=t}}class O{constructor(t,i){h(this,"timeout",void 0),h(this,"object",void 0),this.timeout=t,this.object=i}}class E extends j{getNextObject(t){if(!(this.total>this.limit)&&(this.lastCreateTime+=1,this.lastCreateTime>this.delay)){const t=this.create(this.total);return this.lastCreateTime=0,this.total++,t}}constructor(t,i,e,s){super(t),this.limit=i,this.total=0,this.delay=e,this.create=s,this.lastCreateTime=0}}class C{configure(){this.gravity=new u(0,100),this.useFixedTime=!0,this.step=.017/this.subSteps}addObject(t){this.objects.push(t)}update(t){const i=this.useFixedTime?this.step:t/this.subSteps;for(let t=0;t<this.subSteps;t++)this.applyGravity(),this.applyConstrains(),this.processCollisions(),this.updateObjects(i)}updateObjects(t){this.objects.forEach((i=>i.update(t)))}applyGravity(){this.objects.forEach((t=>t.accelerate(this.gravity)))}applyConstrains(){this.objects.forEach((t=>this.constrains.applyConstrain(t)))}processCollisions(){this.objects.forEach((t=>{this.objects.forEach((i=>{t!==i&&t.collide(i)}))}))}constructor(){h(this,"objects",[]),h(this,"constrains",null),this.gravity=u.Zero(),this.objects=[],this.subSteps=4,this.configure()}}class S extends p{render(){this.context.fillStyle=this.color,this.context.fillRect(this.position.x,this.position.y,this.position.x+this.size.x,this.position.y+this.size.y)}constructor(t,i,e,s){super(t,i),h(this,"size",u.Zero()),h(this,"color","#00ff00"),this.size=e,s&&(this.color=s)}}class z{update(){this.renderItem.position=this.ballsObject.currentPosition}render(){this.update(),this.renderItem.render()}constructor(t,i){h(this,"ballsObject",null),h(this,"renderItem",null),this.ballsObject=t,this.renderItem=i}}class N extends g{update(t){this.currentPosition=this._fixedPosition,this.previousPosition=this._fixedPosition}constructor(t,i){super(t,i),h(this,"type",y),h(this,"_fixedPosition",null),this._fixedPosition=t.copy()}}class T extends z{update(){super.update(),this.renderItem.direction=this.ballsObject._direction}constructor(t,i){super(t),h(this,"ballsObject",null),this.ballsObject=t,this.renderItem=i}}class k extends g{update(t){this.currentPosition=this._line._vec1,this.previousPosition=this._line._vec2}constructor(t,i){super(t,0),h(this,"_direction",void 0),h(this,"_line",void 0),h(this,"type",w),this._direction=i,this._line=new l(this.currentPosition.copy(),this.currentPosition.copy().sum(this._direction))}}class F extends p{render(){this.context.strokeStyle=this.color,this.context.beginPath(),this.context.moveTo(this.position.x,this.position.y),this.context.lineTo(this.position.x+this.direction.x,this.position.y+this.direction.y),this.context.stroke()}constructor(t,i,e,s){super(t,i),h(this,"direction",u.Zero()),h(this,"color","#00ff00"),this.direction=e,s&&(this.color=s)}}class R extends x{render(){super.render(),this.context.fillStyle=this.textColor,this.context.textBaseline="middle",this.context.textAlign="center",this.context.fillText(this.text,this.position.x,this.position.y)}constructor(t,i,e,s,n,r){super(t,i,e,s),h(this,"text",""),h(this,"textColor","#ffffff"),this.text=n,r&&(this.textColor=r)}}new O(1,new g(new u(10,10))),new O(2,new g(new u(10,10))),new O(3,new g(new u(10,10)));const V=[new u(60,110),new u(130,490),new u(330,490),new u(400,110)],Z=[[V[0],f.diff(V[0],V[1]).flip()],[V[1],f.diff(V[1],V[2]).flip()],[V[2],f.diff(V[2],V[3]).flip()]],I={57:"#ffffff",78:"#ffffff",71:"#ffffff",86:"#ffffff",200:"#ffffff",202:"#ffffff",218:"#ffffff"};class A{configure(){this.solver=new C,this.context.font="10px serif",this.switchToViewportConstrain(),this.solver.constrains=this.constrains;new u(this.canvas.width/2,this.canvas.height/2);const t=new u(10,10),i=new u(3,-3).mul(1/this.solver.subSteps);this.generator=new E(this.solver,300,10,(e=>new z(new g(t,10).setVelocity(i),new R(this.context,u.Zero(),10,I[e],e,"#000000")))),this.addObject(new z(new N(new u(230,50),30),new x(this.context,u.Zero(),30,"#ff0000"))),Z.forEach((t=>{this.addObject(new T(new k(t[0],t[1]),new F(this.context,u.Zero(),u.Zero(),"#ffffff")))}))}addObject(t){this.objects.push(t),this.solver.addObject(t.ballsObject)}update(t){this.solver.update(t)}generatorsTick(t){const i=this.generator.getNextObject(t);i&&this.addObject(i)}tick(){this.step<0&&(this.step=0),this.generatorsTick(this.step/1e3),this.update(this.step/1e3),this.clear(),this.renderItems(),this.printFPS()}renderItems(){this.items.forEach((t=>t.render())),this.objects.forEach((t=>t.render()))}printText(t,i,e){this.context.fillStyle="#ffffff",this.context.textAlign="start",this.context.fillText(t,i,e)}printFPS(){this.printText(`${Math.round(this.step)} ms / ${Math.round(1e3/this.step)} FPS`,0,10)}clear(){this.context.fillStyle="#ffffff",this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}start(){self.requestAnimationFrame?self.requestAnimationFrame(this.nextFrame):setInterval(this.nextInterval,16)}switchToCircleConstrain(){this.constrains=new P(new u(this.canvas.width/2,this.canvas.height/2),this.canvas.height/2),this.items.push(new x(this.context,this.canvas.width/2,this.canvas.height/2,this.canvas.height/2,"#000000"))}switchToViewportConstrain(){this.constrains=new _(this.canvas.width,this.canvas.height),this.items.push(new S(this.context,u.Zero(),new u(this.canvas.width,this.canvas.height),"#000000"))}constructor(t){h(this,"objects",[]),h(this,"constrains",null),h(this,"solver",null),h(this,"nextFrame",(t=>{this.step=t-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=t,self.requestAnimationFrame(this.nextFrame)})),h(this,"nextInterval",(()=>{this.timeRenderStart=performance.now(),this.step=this.timeRenderStart-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=performance.now()})),this.canvas=t,this.context=this.canvas.getContext("2d"),this.timeRenderStart=performance.now(),this.timeRenderEnd=performance.now(),this.step=0,this.objects=[],this.items=[],this.generator=null,this.solver=null,this.configure()}}var B,H,K,M={};B=function(t,i,e){if(i===self.location.origin)return t;var s=e?"import "+JSON.stringify(t)+";":"importScripts("+JSON.stringify(t)+");";return URL.createObjectURL(new Blob([s],{type:"application/javascript"}))};var q={};function X(t){return(""+t).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}H=function(t){var i=q[t];return i||(i=function(){try{throw new Error}catch(i){var t=(""+i.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(t)return X(t[2])}return"/"}(),q[t]=i),i},K=function(t){var i=(""+t).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!i)throw new Error("Origin not found");return i[0]};let L=H("5d7Nu")+n("iE7OH").resolve("gVigP");var G;M=B(L,K(L),!1),G=function(){console.log("Init application");const t=function(t){const i=document.querySelector(t);if(!i)throw new o(t);return i}("#image_canvas");if(t.transferControlToOffscreen){console.log("Render in worker");const i=new Worker(M),e=t.transferControlToOffscreen();i.postMessage({canvas:e},[e])}else console.log("Render in main thread"),new A(t).start()},document.readyState!==r?G():document.addEventListener("DOMContentLoaded",G)}();
//# sourceMappingURL=index.5ed5374c.js.map
