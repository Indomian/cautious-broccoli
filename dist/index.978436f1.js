!function(){function t(t,e,s,i){Object.defineProperty(t,e,{get:s,set:i,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},i={},n=e.parcelRequire62ee;null==n&&((n=function(t){if(t in s)return s[t].exports;if(t in i){var e=i[t];delete i[t];var n={id:t,exports:{}};return s[t]=n,e.call(n.exports,n,n.exports),n.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){i[t]=e},e.parcelRequire62ee=n),n.register("iE7OH",(function(e,s){var i,n;t(e.exports,"register",(function(){return i}),(function(t){return i=t})),t(e.exports,"resolve",(function(){return n}),(function(t){return n=t}));var r={};i=function(t){for(var e=Object.keys(t),s=0;s<e.length;s++)r[e[s]]=t[e[s]]},n=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),n("iE7OH").register(JSON.parse('{"5d7Nu":"index.978436f1.js","bG1Fz":"main.d4701455.js"}'));const r="loading";class o extends Error{}function h(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class l{addHandlers(){this._canvas.addEventListener("mouseenter",this.mouseEnter),this._canvas.addEventListener("mouseleave",this.mouseLeave),this._canvas.addEventListener("mousemove",this.mouseMove),this._canvas.addEventListener("mousedown",this.mouseDown),this._canvas.addEventListener("mouseup",this.mouseUp),this._canvas.addEventListener("click",this.click)}removeHandlers(){}processEvent(t){this._handlers.forEach((e=>{e(t)}))}addHandler(t){this._handlers.add(t)}removeHandler(t){this._handlers.has(t)&&this._handlers.delete(t)}createMouseEvent(t){return{screenX:t.offsetX,screenY:t.offsetY,dx:-this._oldX+t.offsetX,dy:-this._oldY+t.offsetY,leftButtonDown:this._leftButtonDown}}constructor(t){h(this,"mouseEnter",(t=>{const e=this.createMouseEvent(t);this.processEvent(e),this._oldX=e.screenX,this._oldY=e.screenY})),h(this,"mouseLeave",(t=>{const e=this.createMouseEvent(t);this.processEvent(e),this._oldX=e.screenX,this._oldY=e.screenY})),h(this,"mouseMove",(t=>{const e=this.createMouseEvent(t);this.processEvent(e),this._oldX=e.screenX,this._oldY=e.screenY})),h(this,"mouseDown",(t=>{this._leftButtonDown=!0;const e=this.createMouseEvent(t);this.processEvent(e),this._oldX=e.screenX,this._oldY=e.screenY})),h(this,"mouseUp",(t=>{this._leftButtonDown=!1;const e=this.createMouseEvent(t);this.processEvent(e),this._oldX=e.screenX,this._oldY=e.screenY})),h(this,"click",(t=>{const e=this.createMouseEvent(t);this.processEvent(e),this._oldX=e.screenX,this._oldY=e.screenY})),this._canvas=t,this._handlers=new Set,this._leftButtonDown=!1,this.addHandlers()}}let c;var a;(a=c||(c={}))[a.MessageNone=0]="MessageNone",a[a.MessageInit=1]="MessageInit",a[a.MessageUserInput=2]="MessageUserInput";class d{constructor(){h(this,"type",c.MessageNone)}}class u extends d{constructor(t){super(),h(this,"type",c.MessageInit),this.canvas=t}}class f extends d{constructor(t){super(),h(this,"type",c.MessageUserInput),this.event=t}}var p,x,v,_;x=function(t,e,s){if(e===self.location.origin)return t;var i=s?"import "+JSON.stringify(t)+";":"importScripts("+JSON.stringify(t)+");";return URL.createObjectURL(new Blob([i],{type:"application/javascript"}))};var y={};function g(t){return(""+t).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}v=function(t){var e=y[t];return e||(e=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(t)return g(t[2])}return"/"}(),y[t]=e),e},_=function(t){var e=(""+t).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!e)throw new Error("Origin not found");return e[0]};let w=v("5d7Nu")+n("iE7OH").resolve("bG1Fz");p=x(w,_(w),!1);class m{initUserInput(){}constructor(t){h(this,"sendUserInputEvent",(t=>{this.worker.postMessage(new f(t))})),this.worker=new Worker(p);const e=t.transferControlToOffscreen();this.worker.postMessage(new u(e),[e]),this.userInput=new l(t),this.userInput.addHandler(this.sendUserInputEvent)}}class b extends Error{}class C extends b{}class j extends b{}class S{static diff(t,e){return new I(t.x-e.x,t.y-e.y)}static mul(t,e){return new I(t.x*e,t.y*e)}static distance(t,e){return S.diff(t,e).length}static distance2(t,e){return S.diff(t,e).length2}static intersect(t,e){if(t.K===e.K)throw new C;if(isNaN(t.K)||isNaN(e.K))return isNaN(t.K)?e.makeVec2FromX(t._vec1.x):t.makeVec2FromX(e._vec1.x);{const s=(t.B-e.B)/(e.K-t.K);return t.makeVec2FromX(s)}}static dot(t,e){return t.x*e.x+t.y*e.y}static mirror(t,e){const s=e.direction.perpendicular;return t.diff(s.mul(2*S.dot(t,s)))}static scale(t,e){return new I(t.x/e.x,t.y/e.y)}}const E=1e-6,P=Math.sqrt(2);class I{get x(){return this._x}get y(){return this._y}set x(t){this._x=t,this._length=null}set y(t){this._y=t,this._length=null}get length(){return null===this._length&&(this._length=Math.sqrt(this.x*this.x+this.y*this.y),I.lengthCallsCount++),this._length}get length2(){return null===this._length2&&(this._length2=this._x*this._x+this._y*this._y,I.length2CallsCount++),this._length2}addSelf(t){return this._x+=t.x,this._y+=t.y,this._length=null,this}subSelf(t){return this._x-=t.x,this._y-=t.y,this._length=null,this}flipYSelf(){return this._y=-this._y,this}flipXSelf(){return this._x=-this._x,this}flipSelf(){return this._x=-this._x,this._y=-this._y,this}equals(t){return S.distance2(this,t)<1e-12}sum(t){return new I(this.x+t.x,this.y+t.y)}diff(t){return new I(this.x-t.x,this.y-t.y)}mul(t){return new I(this.x*t,this.y*t)}copy(){return new I(this.x,this.y)}applySelf(t){return this.x=t(this.x),this.y=t(this.y),this}get ort(){const t=this.length;return new I(this.x/t,this.y/t,1)}get perpendicular(){if(0===this.x){if(this.y>0)return I.Horizontal().ort;if(this.y<0)return I.Horizontal().ort.flipSelf();throw new j}if(0===this.y){if(this.x>0)return I.Vertical().ort;if(this.x<0)return I.Vertical().ort.flipSelf()}return new I(-this.y/this.x,1).ort}static Zero(){return new I(0,0)}static Horizontal(){return new I(1,0)}static Vertical(){return new I(0,1)}static Down(t){return new I(0,t)}static Right(t){return new I(t,0)}constructor(t,e,s){h(this,"_x",0),h(this,"_y",0),h(this,"_length",null),h(this,"_length2",null),this._x=t,this._y=e,s&&(this._length=s,this._length2=s*s)}}h(I,"lengthCallsCount",0),h(I,"length2CallsCount",0);class T{render(){}queue(){}constructor(t,e){h(this,"position",I.Zero()),this.context=t,this.position=e}}class O extends T{render(){this.context.beginPath(),this.context.arc(this.position.x,this.position.y,this.r,0,2*Math.PI),this.context.fillStyle=this.color,this.context.fill()}constructor(t,e,s,i){super(t,e),h(this,"r",0),h(this,"color","#00ff00"),s&&(this.r=s),i&&(this.color=i)}}class M{inBetween(t){const e=S.diff(t,this._vec1).length+S.diff(this._vec2,t).length;return s=this._length,i=e,n=E,Math.abs(s-i)<n;var s,i,n}calculateKB(){this._vec1.y===this._vec2.y?(this._b=this._vec1.y,this._k=0):this._vec1.x===this._vec2.x?(this._b=NaN,this._k=NaN):(this._b=(this._vec1.x*this._vec2.y-this._vec1.y*this._vec2.x)/(this._vec1.x-this._vec2.x),this._k=(this._vec1.y-this._vec2.y)/(this._vec1.x-this._vec2.x))}makeVec2FromX(t){return new I(t,this._k*t+this._b)}copy(){return new M(this._vec1,this._vec2)}moveBy(t){this._vec1.addSelf(t),this._vec2.addSelf(t),this.calculateKB()}getPointProjection(t){const e=this.direction,s=S.diff(t,this._vec1),i=S.dot(e,s)/this.length;return this._vec1.sum(this.ort.mul(i))}get B(){return this._b}get K(){return this._k}get length(){return this._length}get direction(){return this._direction}get ort(){return this._ort}get vec1(){return this._vec1}get vec2(){return this._vec2}static Vertical(t){return new M(new I(t,0),new I(t,Number.MAX_SAFE_INTEGER))}static Horizontal(t){return new M(new I(0,t),new I(Number.MAX_SAFE_INTEGER,t))}constructor(t,e){h(this,"_vec1",I.Zero()),h(this,"_vec2",I.Zero()),h(this,"_k",0),h(this,"_b",0),this._vec1=t,this._vec2=e,this._direction=S.diff(this._vec1,this._vec2),this._length=this._direction.length,this._length2=this._direction.length2,this._ort=this._direction.ort,this.calculateKB()}}let G;var z;function B(t,e){let s=t,i=e;if(s.type>i.type){const t=function(t,e){return{a:e,b:t}}(s,i);s=t.a,i=t.b}switch(!0){case s.type===G.TypeBall&&i.type===G.TypeBall:return function(t,e){const s=S.diff(t.currentPosition,e.currentPosition),i=s.length,n=t.radius+e.radius;if(i<n){const r=s.ort,o=n-i;t.currentPosition.addSelf(S.mul(r,t.radius/n*o*t.bounceValue)),e.currentPosition.subSelf(S.mul(r,e.radius/n*o*e.bounceValue))}}(s,i);case s.type===G.TypeBall&&i.type===G.TypeImmovableBall:return function(t,e){const s=S.diff(t.currentPosition,e.currentPosition),i=s.length,n=t.radius+e.radius;if(i<n){const e=s.ort,r=n-i;t.currentPosition.addSelf(S.mul(e,t.radius/n*r*t.bounceValue))}}(s,i);case s.type===G.TypeBall&&i.type===G.TypeImmovableLine:return function(t,e){try{const s=e._line.getPointProjection(t.currentPosition);if(e._line.inBetween(s)){const e=S.diff(s,t.currentPosition);if(e.length<t.radius){const s=e.ort,i=t.radius-e.length;t.currentPosition.subSelf(S.mul(s,i*t.bounceValue))}}}catch(t){}}(s,i);default:return}}(z=G||(G={}))[z.TypeNull=0]="TypeNull",z[z.TypeBall=1]="TypeBall",z[z.TypeImmovableBall=2]="TypeImmovableBall",z[z.TypeImmovableLine=3]="TypeImmovableLine";class k{update(t){}accelerate(t){}collide(t){}addToGrid(t){}constructor(){h(this,"type",G.TypeNull),h(this,"previousPosition",I.Zero()),h(this,"currentPosition",I.Zero()),this.index=k.index++}}h(k,"index",0);class N extends k{update(t){const e=this.velocity;this.previousPosition=this.currentPosition.copy(),this.currentPosition.addSelf(e.addSelf(this.acc.mul(t*t))),this.acc=I.Zero()}accelerate(t){return this.acc.addSelf(t),this}setVelocity(t){return this.velocity=t,this}collide(t){B(this,t)}addToGrid(t){t.addObject(Math.floor(this.currentPosition.x),Math.floor(this.currentPosition.y),this)}moveBy(t){this.currentPosition.addSelf(t)}isPointInsideObject(t){return S.distance(this.currentPosition,t)<this.radius}get velocity(){return S.diff(this.currentPosition,this.previousPosition)}set velocity(t){this.previousPosition=S.diff(this.currentPosition,t)}get movementVector(){return new M(this.previousPosition,this.currentPosition)}constructor(t,e){super(),h(this,"acc",I.Zero()),h(this,"radius",10),h(this,"bounceValue",1.1),h(this,"type",G.TypeBall),h(this,"immovable",!1),this.previousPosition=t.copy(),this.currentPosition=t.copy(),void 0!==e&&(this.radius=e)}}class F{applyConstrain(t){}constructor(){}}class R extends F{get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}applyConstrain(t){super.applyConstrain(t),t.currentPosition.x-t.radius<0&&(t.currentPosition.x=t.radius),t.currentPosition.x+t.radius>this._width&&(t.currentPosition.x=this._width-t.radius),t.currentPosition.y-t.radius<0&&(t.currentPosition.y=t.radius),t.currentPosition.y+t.radius>this._height&&(t.currentPosition.y=this._height-t.radius)}constructor(t,e){super(),h(this,"_width",0),h(this,"_height",0),this.width=t,this.height=e}}class X extends F{applyConstrain(t){super.applyConstrain(t);const e=t.currentPosition.diff(this.center),s=e.length,i=t.radius;if(s>this.radius-i){const s=e.ort;t.currentPosition=this.center.sum(s.mul(this.radius-i))}}constructor(t,e){super(),h(this,"center",I.Zero()),h(this,"radius",0),this.center=t,this.radius=e}}class V{getNextObject(t){return[]}constructor(t){h(this,"solver",null),this.solver=t}}class L{constructor(t,e){h(this,"timeout",void 0),h(this,"object",void 0),this.timeout=t,this.object=e}}class H extends V{getNextObject(t){if(this.total>this.limit)return[];if(this.lastCreateTime+=1,this.lastCreateTime>this.delay){const t=this.create(this.total);return this.lastCreateTime=0,this.total+=t.length,t}}constructor(t,e,s,i){super(t),this.limit=e,this.total=0,this.delay=s,this.create=i,this.lastCreateTime=0}}class Y{addObject(t){this.objects.push(t)}clear(){this.objects=[],this.highlight=!1}remove(t){const e=this.objects.findIndex((e=>e.index===t));-1!==e&&this.objects.splice(e,1)}get count(){return this.objects.length}constructor(){h(this,"objects",[]),h(this,"highlight",!1)}}class Z{get size(){return this._size}get width(){return this._width}set width(t){this._width=t,this.resize()}get height(){return this._height}set height(t){this._height=t,this.resize()}resize(){this.cells=[],this._size=this._width*this._height;for(let t=0;t<this._size;t++)this.cells.push(new Y)}addObject(t,e,s){const i=Math.floor(t/this.cellSize.x),n=Math.floor(e/this.cellSize.y),r=i*this.width+n;this.addObjectByIndex(r,s)}addObjectByIndex(t,e){!isNaN(t)&&t>=0&&t<this.size&&this.cells[t].addObject(e)}makeIndexFromVec(t){return t.x*this.width+t.y}makeIndexFromCoord(t,e){return t*this.width+e}addObjectToCells(t,e,s){const i=S.scale(t,this.cellSize).applySelf(Math.floor),n=S.scale(e,this.cellSize).applySelf(Math.floor),r=this.makeIndexFromVec(i),o=this.makeIndexFromVec(n);if(i.x===n.x)for(let t=r;t<o;t++)this.cells[t].addObject(s);else if(i.y===n.y)for(let t=r;t<o;t+=this.height)this.cells[t].addObject(s);else{let t=Math.min(i.x,n.x),e=Math.min(i.y,n.y),r=Math.max(i.x,n.x),o=Math.max(i.y,n.y)-e,h=this.makeIndexFromCoord(t,e);for(let e=0;e<=r-t;e++)for(let t=0;t<=o;t++){const i=h+e*this.height+t;this.addObjectByIndex(i,s)}}}clear(){for(let t=0;t<this.size;t++)this.cells[t].clear()}forEach(t){this.cells.forEach(((e,s)=>{const i=Math.floor(s/this.width),n=s-i*this.width;t(i,n,e,s)}))}hasCell(t,e){if(t<0||t>=this.size)return!1;const s=Math.floor(t/this.width),i=t-s*this.width;return!(i<=0&&e<0)&&(!(i===this.height-1&&e>0)&&(!(0===s&&e<0)&&!(s>=this.width-1&&e>0)))}constructor(t,e,s){h(this,"cells",[]),this._width=t,this._height=e,this.cellSize=s,this.resize()}}class U{configure(){this.gravity=new I(0,100),this.useFixedTime=!0,this.step=.017/this.subSteps;this.cellSize=new I(this.worldSize.x/30,this.worldSize.y/30),this.collisionGrid=new Z(30,30,this.cellSize)}addObject(t){this.objects.push(t)}update(t){const e=this.useFixedTime?this.step:t/this.subSteps;for(let t=0;t<this.subSteps;t++)this.addObjectsToGrid(),this.processCollisions(),this.applyGravity(),this.updateObjects(e),this.applyConstrains()}addObjectsToGrid(){this.collisionGrid.clear(),this.objects.forEach(((t,e)=>{t.addToGrid(this.collisionGrid)}))}updateObjects(t){this.objects.forEach((e=>e.update(t)))}applyGravity(){this.objects.forEach((t=>t.accelerate(this.gravity)))}applyConstrains(){this.objects.forEach((t=>this.constrains.applyConstrain(t)))}processCollisionsInCell(t,e){e.objects.forEach((e=>{t!==e&&(t.immovable&&e.immovable||t.collide(e))}))}processCell(t){this.collisionGrid.cells[t].objects.forEach((e=>{this.processCollisionsInCell(e,this.collisionGrid.cells[t]),this.collisionGrid.hasCell(t,-1)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t-1]),this.collisionGrid.hasCell(t,1)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t+1]),this.collisionGrid.hasCell(t+this.collisionGrid.height,-1)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t+this.collisionGrid.height-1]),this.collisionGrid.hasCell(t+this.collisionGrid.height,0)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t+this.collisionGrid.height]),this.collisionGrid.hasCell(t+this.collisionGrid.height,1)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t+this.collisionGrid.height+1]),this.collisionGrid.hasCell(t-this.collisionGrid.height,-1)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t-this.collisionGrid.height-1]),this.collisionGrid.hasCell(t-this.collisionGrid.height,0)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t-this.collisionGrid.height]),this.collisionGrid.hasCell(t-this.collisionGrid.height,1)&&this.processCollisionsInCell(e,this.collisionGrid.cells[t-this.collisionGrid.height+1])}))}processCollisions(){for(let t=0;t<this.collisionGrid.size;t++)this.processCell(t)}constructor(t){h(this,"objects",[]),h(this,"constrains",null),h(this,"gravity",I.Zero()),h(this,"subSteps",4),h(this,"useFixedTime",!0),this.objects=[],this.worldSize=t.copy(),this.configure()}}class D extends T{render(){this.context.fillStyle=this.color,this.context.fillRect(this.position.x,this.position.y,this.position.x+this.size.x,this.position.y+this.size.y)}constructor(t,e,s,i){super(t,e),h(this,"size",I.Zero()),h(this,"color","#00ff00"),this.size=s,i&&(this.color=i)}}class q{update(){this.renderItem.position=this.ballsObject.currentPosition}render(){this.update(),this.renderItem.render()}constructor(t,e){h(this,"ballsObject",null),h(this,"renderItem",null),this.ballsObject=t,this.renderItem=e}}class A extends N{update(t){this.currentPosition=this._fixedPosition,this.previousPosition=this._fixedPosition}addToGrid(t){const e=new I(this.radius*P,this.radius*P),s=this.currentPosition.sum(e),i=this.currentPosition.diff(e);t.addObjectToCells(s,i,this)}constructor(t,e){super(t,e),h(this,"type",G.TypeImmovableBall),h(this,"immovable",!0),h(this,"_fixedPosition",null),this._fixedPosition=t.copy()}}class K extends q{update(){super.update(),this.renderItem.direction=this.ballsObject._direction}constructor(t,e){super(t),h(this,"ballsObject",null),this.ballsObject=t,this.renderItem=e}}class $ extends N{update(t){this.currentPosition=this._line._vec1,this.previousPosition=this._line._vec2}addToGrid(t){t.addObjectToCells(this._line._vec1,this._line._vec2,this)}constructor(t,e){super(t,0),h(this,"type",G.TypeImmovableLine),h(this,"immovable",!0),this._direction=e,this._line=new M(this.currentPosition.copy(),this.currentPosition.copy().sum(this._direction))}}class J extends T{render(){this.context.strokeStyle=this.color,this.context.beginPath(),this.context.moveTo(this.position.x,this.position.y),this.context.lineTo(this.position.x+this.direction.x,this.position.y+this.direction.y),this.context.stroke()}constructor(t,e,s,i){super(t,e),h(this,"direction",I.Zero()),h(this,"color","#00ff00"),this.direction=s,i&&(this.color=i)}}class W extends O{render(){super.render(),this.context.fillStyle=this.textColor,this.context.textBaseline="middle",this.context.textAlign="center",this.context.fillText(this.text,this.position.x,this.position.y)}constructor(t,e,s,i,n,r){super(t,e,s,i),h(this,"text",""),h(this,"textColor","#ffffff"),this.text=n,r&&(this.textColor=r)}}class Q extends D{render(){this.context.strokeStyle=this.color,this.context.strokeRect(this.position.x,this.position.y,this.size.x,this.size.y)}queue(){}constructor(t,e,s,i){super(t,e,s,i)}}new L(1,new N(new I(10,10))),new L(2,new N(new I(10,10))),new L(3,new N(new I(10,10)));const tt=[new I(60,110),new I(130,490),new I(330,490),new I(400,110)],et=[[tt[0],S.diff(tt[0],tt[1]).flipSelf()],[tt[1],S.diff(tt[1],tt[2]).flipSelf()],[tt[2],S.diff(tt[2],tt[3]).flipSelf()]];function st(t){const e=.005;return`rgba(${Math.floor(127*Math.sin(e*t+0)+128)}, ${Math.floor(127*Math.sin(e*t+2)+128)}, ${Math.floor(127*Math.sin(e*t+4)+128)}, 1)`}class it{configure(){this.solver=new U(new I(this.canvas.width,this.canvas.height)),this.context.font="10px serif",this.switchToViewportConstrain(),this.solver.constrains=this.constrains;new I(this.canvas.width/2,this.canvas.height/2);const t=new I(10,100),e=new I(2,-2).mul(1/this.solver.subSteps);this.generator=new H(this.solver,1e3,7,(s=>[new q(new N(t,5).setVelocity(e),new W(this.context,I.Zero(),7,st(s+200),"","#000000")),new q(new N(t.sum(I.Down(20)),5).setVelocity(e),new W(this.context,I.Zero(),7,st(s+100),"","#000000")),new q(new N(t.sum(I.Down(-20)),5).setVelocity(e),new W(this.context,I.Zero(),7,st(s),"","#000000"))])),this.redBall=new q(new A(new I(230,50),30),new O(this.context,I.Zero(),30,"#ff0000")),this.addObject(this.redBall),et.forEach((t=>{this.addObject(new K(new $(t[0],t[1]),new J(this.context,I.Zero(),I.Zero(),"#ffffff")))}))}processUserInput(t){t.leftButtonDown?(this.redBall.ballsObject.isPointInsideObject(new I(t.screenX,t.screenY))&&(this.canMoveRedObject=!0),this.canMoveRedObject&&this.redBall.ballsObject.moveBy(new I(t.dx,t.dy))):this.canMoveRedObject=!1}addObject(t){this.objects.push(t),this.solver.addObject(t.ballsObject)}update(t){this.solver.update(t)}generatorsTick(t){const e=this.generator.getNextObject(t);e&&e.forEach((t=>this.addObject(t)))}tick(){this.step<0&&(this.step=0),this.generatorsTick(this.step/1e3),this.update(this.step/1e3),this.clear(),this.renderItems(),this.printFPS(),I.lengthCallsCount=0}renderItems(){this.items.forEach((t=>t.render())),this.objects.forEach((t=>t.render()))}printText(t,e,s){this.context.fillStyle="#ffffff",this.context.textAlign="start",this.context.fillText(t,e,s)}printFPS(){this.context.fillStyle="rgba(0,0,0,0.1)",this.context.fillRect(0,0,100,60),this.printText(`${Math.round(this.step)} ms / ${Math.round(1e3/this.step)} FPS`,0,10),this.printText(`Length calls: ${I.lengthCallsCount}`,0,20),this.printText(`Lenght2 calls: ${I.length2CallsCount}`,0,30),this.printText(`Objects: ${this.objects.length}`,0,40),this.printText(`Compares per object: ${Math.round(I.lengthCallsCount/this.objects.length)}`,0,50)}clear(){this.context.fillStyle="rgba(0, 0, 0, 0.9)",this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}start(){self.requestAnimationFrame?self.requestAnimationFrame(this.nextFrame):setInterval(this.nextInterval,16)}renderGrid(){this.solver.collisionGrid.forEach(((t,e,s,i)=>{const n=new I(t*this.solver.cellSize.x,e*this.solver.cellSize.y),r=new Q(this.context,n,this.solver.cellSize.diff(new I(5,5)),s.count>0?"#ff0000":"#00ff00");s.highlight&&(this.context.lineWidth=10),r.render(),this.context.lineWidth=1,this.printText(s.count,n.x+this.solver.cellSize.x/2,n.y+this.solver.cellSize.y/2)}))}switchToCircleConstrain(){this.constrains=new X(new I(this.canvas.width/2,this.canvas.height/2),this.canvas.height/2),this.items.push(new O(this.context,this.canvas.width/2,this.canvas.height/2,this.canvas.height/2,"#000000"))}switchToViewportConstrain(){this.constrains=new R(this.canvas.width,this.canvas.height)}constructor(t){h(this,"objects",[]),h(this,"constrains",null),h(this,"solver",null),h(this,"nextFrame",(t=>{this.step=t-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=t,self.requestAnimationFrame(this.nextFrame)})),h(this,"nextInterval",(()=>{this.timeRenderStart=performance.now(),this.step=this.timeRenderStart-this.timeRenderEnd,this.step<0&&(this.step=0),this.tick(),this.timeRenderEnd=performance.now()})),this.canvas=t,this.context=this.canvas.getContext("2d"),this.timeRenderStart=performance.now(),this.timeRenderEnd=performance.now(),this.step=0,this.objects=[],this.items=[],this.generator=null,this.solver=null,this.redBall=null,this.configure()}}class nt{constructor(t){h(this,"sendUserInputEvent",(t=>{this.render.processUserInput(t)})),this.render=new it(t),this.render.start(),this.userInput=new l(t),this.userInput.addHandler(this.sendUserInputEvent)}}var rt;rt=function(){console.log("Init application");const t=function(t){const e=document.querySelector(t);if(!e)throw new o(t);return e}("#image_canvas");t.transferControlToOffscreen?(console.log("Render in worker"),new m(t)):(console.log("Render in main thread"),new nt(t))},document.readyState!==r?rt():document.addEventListener("DOMContentLoaded",rt)}();
//# sourceMappingURL=index.978436f1.js.map
