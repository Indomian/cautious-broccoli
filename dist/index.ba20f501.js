function t(t,e,n,o){Object.defineProperty(t,e,{get:n,set:o,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},o={},i=e.parcelRequire62ee;null==i&&((i=function(t){if(t in n)return n[t].exports;if(t in o){var e=o[t];delete o[t];var i={id:t,exports:{}};return n[t]=i,e.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){o[t]=e},e.parcelRequire62ee=i),i.register("gC69E",(function(e,n){var o,i;t(e.exports,"register",(function(){return o}),(function(t){return o=t})),t(e.exports,"resolve",(function(){return i}),(function(t){return i=t}));var r={};o=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)r[e[n]]=t[e[n]]},i=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),i("gC69E").register(JSON.parse('{"eawZa":"index.ba20f501.js","iHdMw":"main.a160c039.js"}'));const r="loading";class s extends Error{}function c(t){const e=document.querySelector(t);if(!e)throw new s(t);return e}var u={};t(u,"WorkerApplication",(function(){return j}),(function(t){return j=t}));var a=function(){function t(t){var e=this;this.keyPress=function(t){var n={keyPressed:t.key};e.processEvent(n)},this.mouseEnter=function(t){var n=e.createMouseEvent(t);e.processEvent(n)},this.mouseLeave=function(t){var n=e.createMouseEvent(t);e.processEvent(n)},this.mouseMove=function(t){var n=e.createMouseEvent(t);e.processEvent(n)},this.mouseDown=function(t){e._leftButtonDown=!0;var n=e.createMouseEvent(t);e.processEvent(n)},this.mouseUp=function(t){e._leftButtonDown=!1;var n=e.createMouseEvent(t);e.processEvent(n)},this.click=function(t){var n=e.createMouseEvent(t);e.processEvent(n)},this.touchStart=function(t){if(t.preventDefault(),0!==t.touches.length){e._leftButtonDown=!0;var n=t.touches.item(0),o={screenX:n.pageX,screenY:n.pageY,dx:0,dy:0,leftButtonDown:e._leftButtonDown};e.processEvent(o)}},this.touchMove=function(t){t.preventDefault();var n=e.createTouchEvent(t);n&&e.processEvent(n)},this.touchEnd=function(t){t.preventDefault(),e._leftButtonDown=!1;var n=e.createTouchEndEvent();n&&e.processEvent(n)},this.touchCancel=function(t){t.preventDefault(),e._leftButtonDown=!1;var n=e.createTouchEndEvent();n&&e.processEvent(n)},this._canvas=t,this._handlers=new Set,this._leftButtonDown=!1,this.addHandlers()}return t.prototype.addHandlers=function(){this._canvas.addEventListener("mouseenter",this.mouseEnter),this._canvas.addEventListener("mouseleave",this.mouseLeave),this._canvas.addEventListener("mousemove",this.mouseMove),this._canvas.addEventListener("mousedown",this.mouseDown),this._canvas.addEventListener("mouseup",this.mouseUp),this._canvas.addEventListener("click",this.click),this._canvas.addEventListener("touchstart",this.touchStart,{passive:!1}),this._canvas.addEventListener("touchmove",this.touchMove,{passive:!1}),this._canvas.addEventListener("touchcancel",this.touchCancel,{passive:!1}),this._canvas.addEventListener("touchend",this.touchEnd,{passive:!1}),document.addEventListener("keypress",this.keyPress)},t.prototype.removeHandlers=function(){document.removeEventListener("keypress",this.keyPress)},t.prototype.processEvent=function(t){this._handlers.forEach((function(e){e(t)})),this._oldX=t.screenX,this._oldY=t.screenY},t.prototype.addHandler=function(t){this._handlers.add(t)},t.prototype.removeHandler=function(t){this._handlers.has(t)&&this._handlers.delete(t)},t.prototype.createMouseEvent=function(t){return{screenX:t.offsetX,screenY:t.offsetY,dx:-this._oldX+t.offsetX,dy:-this._oldY+t.offsetY,leftButtonDown:this._leftButtonDown}},t.prototype.createTouchEvent=function(t){var e=t.touches.item(0);return{screenX:e.pageX,screenY:e.pageY,dx:-this._oldX+e.pageX,dy:-this._oldY+e.pageY,leftButtonDown:this._leftButtonDown}},t.prototype.createTouchEndEvent=function(){return{screenX:this._oldX,screenY:this._oldY,dx:0,dy:0,leftButtonDown:this._leftButtonDown}},t}(),h={};t(h,"MessageInit",(function(){return _}),(function(t){return _=t})),t(h,"MessageUserInput",(function(){return g}),(function(t){return g=t})),t(h,"MessageEngineEvent",(function(){return b}),(function(t){return b=t}));var l,p,f,y=(l=function(t,e){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},l(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});(f=p||(p={}))[f.MessageNone=0]="MessageNone",f[f.MessageInit=1]="MessageInit",f[f.MessageUserInput=2]="MessageUserInput",f[f.MessageEngineEvent=3]="MessageEngineEvent";var d,v=function(){this.type=p.MessageNone},_=function(t){function e(e){var n=t.call(this)||this;return n.type=p.MessageInit,n.canvas=e,n}return y(e,t),e}(v),g=function(t){function e(e){var n=t.call(this)||this;return n.type=p.MessageUserInput,n.event=e,n}return y(e,t),e}(v),b=function(t){function e(e){var n=t.call(this)||this;return n.type=p.MessageEngineEvent,n.event=e,n}return y(e,t),e}(v),m={};d=function(t,e,n){if(e===self.location.origin)return t;var o=n?"import "+JSON.stringify(t)+";":"importScripts("+JSON.stringify(t)+");";return URL.createObjectURL(new Blob([o],{type:"application/javascript"}))};let w=new URL(i("gC69E").resolve("iHdMw"),import.meta.url);m=d(w.toString(),w.origin,!0);var x=function(){function t(){}return t.prototype.loadScene=function(t){var e={scene:t};this.sendEngineEvent(e)},t}(),O=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),j=function(t){function e(e){var n=t.call(this)||this;n.sendUserInputEvent=function(t){n.worker.postMessage(new(0,h.MessageUserInput)(t))},n.sendEngineEvent=function(t){n.worker.postMessage(new(0,h.MessageEngineEvent)(t))},n.worker=new Worker(m);var o=e.transferControlToOffscreen();return n.worker.postMessage(new(0,h.MessageInit)(o),[o]),n.userInput=new a(e),n.userInput.addHandler(n.sendUserInputEvent),n}return O(e,t),e}(x),P={};t(P,"DirectApplication",(function(){return ge}),(function(t){return ge=t}));var S={};t(S,"Vec2ExceptionParallel",(function(){return T}),(function(t){return T=t})),t(S,"Vec2ExceptionNoPerpendicularVectorToZeroVector",(function(){return I}),(function(t){return I=t})),t(S,"Vec2ExceptionRectSizeShouldBePositive",(function(){return k}),(function(t){return k=t}));var E=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return E(e,t),e}(Error),T=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return E(e,t),e}(C),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return E(e,t),e}(C),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return E(e,t),e}(C),B=function(){function t(){}return t.diff=function(t,e){return new F(t.x-e.x,t.y-e.y)},t.mul=function(t,e){return new F(t.x*e,t.y*e)},t.distance=function(e,n){return t.diff(e,n).length},t.distance2=function(e,n){return t.diff(e,n).length2},t.intersect=function(t,e){if(t.K===e.K)throw new(0,S.Vec2ExceptionParallel);if(isNaN(t.K)||isNaN(e.K))return isNaN(t.K)?e.makeVec2FromX(t._vec1.x):t.makeVec2FromX(e._vec1.x);var n=(t.B-e.B)/(e.K-t.K);return t.makeVec2FromX(n)},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.mirror=function(e,n){var o=n.direction.perpendicular;return e.diff(o.mul(2*t.dot(e,o)))},t.scale=function(t,e){return new F(t.x/e.x,t.y/e.y)},t}(),R=1e-6,M=Math.sqrt(2);var F=function(){function t(t,e,n){this._x=0,this._y=0,this._length=null,this._length2=null,this._x=t,this._y=void 0===e?t:e,n&&(this._length=n,this._length2=n*n)}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.reset()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.reset()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return null===this._length&&(this._length=Math.sqrt(this.x*this.x+this.y*this.y),t.lengthCallsCount++),this._length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length2",{get:function(){return null===this._length2&&(this._length2=this._x*this._x+this._y*this._y,t.length2CallsCount++),this._length2},enumerable:!1,configurable:!0}),t.prototype.moveTo=function(e,n){e instanceof t?(this._x=e.x,this._y=e.y):(this._x=e,this._y=n),this.reset()},t.prototype.reset=function(){this._length=null,this._length2=null},t.prototype.addSelf=function(t){return this._x+=t.x,this._y+=t.y,this._length=null,this},t.prototype.moveBy=function(t){this.addSelf(t)},t.prototype.subSelf=function(t){return this._x-=t.x,this._y-=t.y,this._length=null,this},t.prototype.flipYSelf=function(){return this._y=-this._y,this},t.prototype.flipXSelf=function(){return this._x=-this._x,this},t.prototype.flipSelf=function(){return this._x=-this._x,this._y=-this._y,this},t.prototype.equals=function(t){return B.distance2(this,t)<1e-12},t.prototype.sum=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.diff=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e,this.y*e)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.copy=function(){return new t(this.x,this.y)},t.prototype.applySelf=function(t){return this.x=t(this.x),this.y=t(this.y),this},t.prototype.isInsideRect=function(t,e){var n=Math.min(t.x,e.x),o=Math.min(t.y,e.y),i=Math.max(t.x,e.x),r=Math.max(t.y,e.y);return this._x>=n&&this._x<=i&&this._y>=o&&this._y<=r},Object.defineProperty(t.prototype,"ort",{get:function(){var e=this.length;return new t(this.x/e,this.y/e,1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"abs",{get:function(){return new t(Math.abs(this.x),Math.abs(this.y))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"perpendicular",{get:function(){if(0===this.x){if(this.y>0)return t.Horizontal().ort;if(this.y<0)return t.Horizontal().ort.flipSelf();throw new(0,S.Vec2ExceptionNoPerpendicularVectorToZeroVector)}if(0===this.y){if(this.x>0)return t.Vertical().ort;if(this.x<0)return t.Vertical().ort.flipSelf()}return new t(-this.y,this.x).ort},enumerable:!1,configurable:!0}),t.Zero=function(){return new t(0,0)},t.Horizontal=function(){return new t(1,0)},t.Vertical=function(){return new t(0,1)},t.Down=function(e){return new t(0,e)},t.Right=function(e){return new t(e,0)},t.lengthCallsCount=0,t.length2CallsCount=0,t}(),L={};t(L,"GridOptimizedSolver",(function(){return G}),(function(t){return G=t}));var D={};t(D,"GridSolverSpace",(function(){return N}),(function(t){return N=t}));var z=function(){},A=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),V=function(){function t(){this.objects=[],this.highlight=!1}return t.prototype.addObject=function(e){this.objects.length>=t.MAX_OBJECT_IN_CELL||this.objects.push(e)},t.prototype.clear=function(){this.objects=[],this.highlight=!1},t.prototype.remove=function(t){var e=this.objects.findIndex((function(e){return e.index===t}));-1!==e&&this.objects.splice(e,1)},Object.defineProperty(t.prototype,"count",{get:function(){return this.objects.length},enumerable:!1,configurable:!0}),t.MAX_OBJECT_IN_CELL=100,t}(),N=function(t){function e(e,n,o){var i=t.call(this)||this;return i.cells=[],i.index2xy=[],i.adjacentCells=[],i._width=e,i._height=n,i.cellSize=o,i.resize(),i}return A(e,t),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.resize()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this.resize()},enumerable:!1,configurable:!0}),e.prototype.recalculateIndex2xy=function(){this.index2xy=[];for(var t=0;t<this._size;t++)this.index2xy.push(this.makeVecFromIndex(t))},e.prototype.recalculateCollisionCells=function(){var t=this;this.adjacentCells=[],this.cells.forEach((function(e,n){var o=t.getVecFromIndex(n),i=[];i.push(e),o.y>0&&i.push(t.cells[t.makeIndexFromCoord(o.x,o.y-1)]),o.y+1<t._height&&i.push(t.cells[t.makeIndexFromCoord(o.x,o.y+1)]),o.x>0&&(o.y>0&&i.push(t.cells[t.makeIndexFromCoord(o.x-1,o.y-1)]),i.push(t.cells[t.makeIndexFromCoord(o.x-1,o.y)]),o.y+1<t._height&&i.push(t.cells[t.makeIndexFromCoord(o.x-1,o.y+1)])),o.x+1<t._width&&(o.y>0&&i.push(t.cells[t.makeIndexFromCoord(o.x+1,o.y-1)]),i.push(t.cells[t.makeIndexFromCoord(o.x+1,o.y)]),o.y+1<t._height&&i.push(t.cells[t.makeIndexFromCoord(o.x+1,o.y+1)])),t.adjacentCells[n]=i}))},e.prototype.getVecFromIndex=function(t){return this.index2xy[t]},e.prototype.resize=function(){this.cells=[],this._size=this._width*this._height;for(var t=0;t<this._size;t++)this.cells.push(new V);this.recalculateIndex2xy(),this.recalculateCollisionCells()},e.prototype.addObject=function(t){this.addObjectByIndex(0,t)},e.prototype.addPointObject=function(t,e,n){var o=Math.trunc(t/this.cellSize.x),i=Math.trunc(e/this.cellSize.y),r=this.makeIndexFromCoord(o,i);this.addObjectByIndex(r,n)},e.prototype.addObjectByIndex=function(t,e){!isNaN(t)&&t>=0&&t<this.size&&this.cells[t].addObject(e)},e.prototype.makeIndexFromVec=function(t){return t.x*this._height+t.y},e.prototype.makeIndexFromCoord=function(t,e){return t*this._height+e},e.prototype.makeVecFromIndex=function(t){var e=Math.trunc(t/this._height),n=t-e*this._height;return new F(e,n)},e.prototype.addRectangularObject=function(t,e,n){var o=B.scale(t,this.cellSize).applySelf(Math.trunc),i=B.scale(e,this.cellSize).applySelf(Math.trunc),r=Math.max(Math.min(o.x,i.x),0),s=Math.max(Math.min(o.y,i.y),0),c=Math.min(Math.max(o.x,i.x),this._width-1),u=Math.min(Math.max(o.y,i.y),this._height-1),a=this.makeIndexFromCoord(r,s),h=this.makeIndexFromCoord(c,u);if(!(c>=this._width||r<0||s<0||u>=this._height))if(o.x===i.x)for(var l=a;l<=h;l++)this.cells[l].addObject(n);else if(o.y===i.y)for(l=a;l<=h;l+=this.height)this.cells[l].addObject(n);else for(var p=u-s,f=this.makeIndexFromCoord(r,s),y=0;y<=c-r;y++)for(var d=0;d<=p;d++){l=f+this.makeIndexFromCoord(y,d);this.addObjectByIndex(l,n)}},e.prototype.clear=function(){this.cells.forEach((function(t){return t.clear()}))},e.prototype.forEach=function(t){var e=this;this.cells.forEach((function(n,o){var i=e.getVecFromIndex(o);t(i.x,i.y,n,o)}))},e.prototype.hasCell=function(t,e){if(t<0||t>=this.size)return!1;var n=this.getVecFromIndex(t),o=n.x,i=n.y;return!(i<=0&&e<0)&&(!(i===this.height-1&&e>0)&&(!(0===o&&e<0)&&!(o>=this.width-1&&e>0)))},e.prototype.debugRender=function(t){var e=this;this.forEach((function(n,o,i,r){var s=new F(n*e.cellSize.x,o*e.cellSize.y);t.strokeStyle(i.count>0?"#ff0000":"#00ff00"),t.lineWidth(i.highlight?10:1),t.rect(s.x,s.y,e.cellSize.x-1,e.cellSize.y-1),t.fillStyle("#ffffff"),t.text("".concat(r),s.sum(e.cellSize.mul(.5)))}))},e}(z),Z=function(){function t(t,e){this.objects=[],this.constrains=null,this.subSteps=4,this.useFixedTime=!0,this.stats=e,this.objects=[],this.worldSize=t.copy(),this.configure()}return t.prototype.reset=function(){this.objects=[]},t.prototype.configure=function(){this.useFixedTime=!0,this.step=.017/this.subSteps},t.prototype.addObject=function(t){this.objects.push(t)},t.prototype.update=function(t){for(var e=this.useFixedTime?this.step:t/this.subSteps,n=0;n<this.subSteps;n++)this.processOptimizations(),this.processCollisions(),this.applyForces(),this.updateObjects(e),this.applyConstrains()},t.prototype.updateObjects=function(t){this.objects.forEach((function(e){return e.update(t)}))},t.prototype.applyConstrains=function(){var t=this;this.objects.forEach((function(e){return t.constrains.applyConstrain(e)}))},t}();var X=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),G=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.gravity=F.Zero(),o.gravityCenter=F.Zero(),o.configure(),o}return X(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.collisionGrid.clear()},e.prototype.configure=function(){t.prototype.configure.call(this),this.gravity=new F(0,100),this.gravityCenter=new F(this.worldSize.x/2,this.worldSize.y/2);var e=Math.round(this.worldSize.x/16),n=Math.round(this.worldSize.y/16);this.cellSize=new F(this.worldSize.x/e,this.worldSize.y/n),this.collisionGrid=new(0,D.GridSolverSpace)(e,n,this.cellSize)},e.prototype.processOptimizations=function(){var t=this;this.collisionGrid.clear(),this.objects.forEach((function(e,n){e.addToSpace(t.collisionGrid),t.stats.addStats("Solver object: ".concat(e.toString()))}))},e.prototype.applyForces=function(){var t=this;this.objects.forEach((function(e){var n=B.diff(e.currentPosition,t.gravityCenter);e.accelerate(n.ort.mul(-t.gravity.length))}))},e.prototype.processCollisionsInCell=function(t,e){var n=this;this.stats.addStats("processCollisionsInCell.calls"),e.objects.forEach((function(e){t!==e&&(t.immovable&&e.immovable||(n.stats.addStats("processCollisions.calls"),t.collide(e)))}))},e.prototype.processCell=function(t){var e=this;this.stats.addStats("processCell.calls",1);var n=this.collisionGrid.cells[t];n.objects.forEach((function(o){e.collisionGrid.adjacentCells[t].forEach((function(t){t===n&&1===t.objects.length||e.processCollisionsInCell(o,t)}))}))},e.prototype.processCollisions=function(){for(var t=0;t<this.collisionGrid.size;t++)this.processCell(t)},e.prototype.debugRender=function(t){this.collisionGrid.debugRender(t),this.objects.forEach((function(e){return e.debugRender(t)}))},e}(Z);var U={};t(U,"Scene1",(function(){return Lt}),(function(t){return Lt=t}));var Y=function(t){this.engine=t},W=function(){function t(t){this.solver=null,this.solver=t}return t.prototype.getNextObjects=function(t){return[]},t}();class H extends W{getNextObjects(t){if(this.total>this.limit)return[];if(this.lastCreateTime+=1,this.lastCreateTime>this.delay){const t=this.create(this.total);return this.lastCreateTime=0,this.total+=t.length,t}return[]}constructor(t,e,n,o){super(t),this.limit=e,this.total=0,this.delay=n,this.create=o,this.lastCreateTime=0}}var q={};t(q,"Circle",(function(){return J}),(function(t){return J=t}));var K=function(){function t(t,e){this.position=F.Zero(),this.renderer=t,this.position=e}return t.prototype.render=function(){},t.prototype.queue=function(){},t}(),Q=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),J=function(t){function e(e,n,o,i){var r=t.call(this,e,n)||this;return r.r=0,r.color="#00ff00",o&&(r.r=o),i&&(r.color=i),r}return Q(e,t),e.prototype.render=function(){this.renderer.strokeStyle(this.color),this.renderer.fillStyle(this.color),this.renderer.fillCircle(this.r,this.position)},e}(K),$={};t($,"BallsObject",(function(){return at}),(function(t){return at=t}));var tt,et,nt=function(){function t(t,e){this._vec1=F.Zero(),this._vec2=F.Zero(),this._k=0,this._b=0,this._vec1=t.copy(),this._vec2=e.copy(),this._direction=B.diff(this._vec1,this._vec2),this._length=this._direction.length,this._length2=this._direction.length2,this._ort=this._direction.ort,this.calculateKB()}return t.prototype.inBetween=function(t){var e,n,o,i=B.diff(t,this._vec1).length+B.diff(this._vec2,t).length;return e=this._length,n=i,o=R,Math.abs(e-n)<o},t.prototype.inBetweenFast=function(t){return t.isInsideRect(this._vec1,this._vec2)},t.prototype.calculateKB=function(){this._vec1.y===this._vec2.y?(this._b=this._vec1.y,this._k=0):this._vec1.x===this._vec2.x?(this._b=NaN,this._k=NaN):(this._b=(this._vec1.x*this._vec2.y-this._vec1.y*this._vec2.x)/(this._vec1.x-this._vec2.x),this._k=(this._vec1.y-this._vec2.y)/(this._vec1.x-this._vec2.x))},t.prototype.makeVec2FromX=function(t){return new F(t,this._k*t+this._b)},t.prototype.copy=function(){return new t(this._vec1,this._vec2)},t.prototype.moveBy=function(t){return this._vec1.addSelf(t),this._vec2.addSelf(t),this.calculateKB(),this},t.prototype.getPointProjection=function(t){var e=this.direction,n=B.diff(t,this._vec1),o=B.dot(e,n)/this.length;return this._vec1.sum(this.ort.mul(o))},Object.defineProperty(t.prototype,"B",{get:function(){return this._b},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"K",{get:function(){return this._k},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ort",{get:function(){return this._ort},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vec1",{get:function(){return this._vec1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vec2",{get:function(){return this._vec2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"normal",{get:function(){return this._vec2.diff(this._vec1).perpendicular},enumerable:!1,configurable:!0}),t.Vertical=function(e){return new t(new F(e,0),new F(e,Number.MAX_SAFE_INTEGER))},t.Horizontal=function(e){return new t(new F(0,e),new F(Number.MAX_SAFE_INTEGER,e))},t}();function ot(t,e,n){try{var o=e.getPointProjection(t.currentPosition);if(e.inBetweenFast(o)){var i=B.diff(o,t.currentPosition);if(i.length2<t.radius2){var r=i.ort,s=(r.dot(e.normal)>0?1:-1)*(t.radius-i.length);t.moveBy(B.mul(r,-s*t.bounceValue*n))}}}catch(t){}}function it(t,e){var n,o,i=t,r=e;if(i.type>r.type){var s=function(t,e){return{a:e,b:t}}(i,r);i=s.a,r=s.b}switch(!0){case i.type===tt.TypeBall&&r.type===tt.TypeBall:return function(t,e){if(t.getBoundary().intersect(e.getBoundary())){var n=B.diff(t.currentPosition,e.currentPosition),o=n.length,i=t.radius+e.radius;if(o<i){var r=n.ort,s=i-o;t.moveBy(B.mul(r,t.radius/i*s*t.bounceValue)),e.moveBy(B.mul(r,-e.radius/i*s*e.bounceValue))}}}(i,r);case i.type===tt.TypeBall&&r.type===tt.TypeImmovableBall:return function(t,e){if(t.getBoundary().intersect(e.getBoundary())){var n=B.diff(t.currentPosition,e.currentPosition),o=n.length,i=t.radius+e.radius;if(o<i){var r=n.ort,s=i-o;t.moveBy(B.mul(r,t.radius/i*s*t.bounceValue*e.bounceValue))}}}(i,r);case i.type===tt.TypeBall&&r.type===tt.TypeImmovableLine:return o=r,void((n=i).getBoundary().intersect(o.getCollisionRange())&&ot(n,o._line,o.bounceValue));case i.type===tt.TypeBall&&r.type===tt.TypeImmovablePolygon:return function(t,e){t.getBoundary().intersect(e.getCollisionRange())&&e.lines.forEach((function(e){return ot(t,e._line,e.bounceValue)}))}(i,r);default:return}}(et=tt||(tt={}))[et.TypeNull=0]="TypeNull",et[et.TypeBall=1]="TypeBall",et[et.TypeImmovableBall=2]="TypeImmovableBall",et[et.TypeImmovableLine=3]="TypeImmovableLine",et[et.TypeImmovablePolygon=4]="TypeImmovablePolygon";var rt=function(){function t(){this.type=tt.TypeNull,this.previousPosition=F.Zero(),this.currentPosition=F.Zero(),t.index+=1,this.index=t.index}return t.prototype.update=function(t){},t.prototype.accelerate=function(t){},t.prototype.collide=function(t){},t.prototype.inside=function(t){return this.currentPosition.x>=t.left&&this.currentPosition.x<=t.right&&this.currentPosition.y>=t.top&&this.currentPosition.y<=t.bottom},t.prototype.debugRender=function(t){},t.prototype.toString=function(){return"BaseSolverObject"},t.index=0,t}(),st=function(){function t(t,e){if(this.position=t.copy(),this.size=e.copy(),this.size.x<0||this.size.y<0)throw new(0,S.Vec2ExceptionRectSizeShouldBePositive);this.recalculate()}return t.prototype.recalculate=function(){this._width2=this.size.x/2,this._height2=this.size.y/2,this._left=this.position.x-this._width2,this._right=this.position.x+this._width2,this._top=this.position.y-this._height2,this._bottom=this.position.y+this._height2},t.prototype.copy=function(){return new t(this.position,this.size)},t.prototype.intersect=function(t){return!(this.left>t.right||this.right<t.left||this.top>t.bottom||this.bottom<t.top)},t.prototype.contains=function(t){return t.x>this.left&&t.x<this.right&&t.y>this.top&&t.y<this.bottom},t.prototype.moveBy=function(t){this.position.addSelf(t),this.recalculate()},t.prototype.moveTo=function(t){this.position=t.copy(),this.recalculate()},Object.defineProperty(t.prototype,"nw",{get:function(){return new t(new F(this.position.x-this._width2/2,this.position.y-this._height2/2),new F(this._width2,this._height2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ne",{get:function(){return new t(new F(this.position.x+this._width2/2,this.position.y-this._height2/2),new F(this._width2,this._height2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"se",{get:function(){return new t(new F(this.position.x+this._width2/2,this.position.y+this._height2/2),new F(this._width2,this._height2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sw",{get:function(){return new t(new F(this.position.x-this._width2/2,this.position.y+this._height2/2),new F(this._width2,this._height2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this._left},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._right},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._bottom},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"diag",{get:function(){return this.size.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.size.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size.y},enumerable:!1,configurable:!0}),t}(),ct=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ut=Math.pow(10,2),at=function(t){function e(e,n){var o=t.call(this)||this;return o.acc=F.Zero(),o.radius=10,o.bounceValue=1.1,o.motionReduce=.999,o.type=tt.TypeBall,o.immovable=!1,o.previousPosition=e.copy(),o.currentPosition=e.copy(),void 0!==n&&(o.radius=n),o._radius2=o.radius*o.radius,o.collisionRange=new st(o.currentPosition,new F(4*o.radius)),o.boundary=new st(o.currentPosition,new F(2*o.radius)),o}return ct(e,t),e.prototype.update=function(t){var e=this.velocity.mul(this.motionReduce);e.length2>ut&&(e=e.ort.mul(10)),this.previousPosition=this.currentPosition.copy(),this.moveBy(e.addSelf(this.acc.mul(t*t))),this.acc=F.Zero()},e.prototype.accelerate=function(t){return this.acc.addSelf(t),this},e.prototype.setVelocity=function(t){return this.velocity=t,this},e.prototype.collide=function(t){it(this,t)},e.prototype.addToSpace=function(t){t.addPointObject(Math.floor(this.currentPosition.x),Math.floor(this.currentPosition.y),this)},e.prototype.moveBy=function(t){this.currentPosition.moveBy(t),this.collisionRange.moveBy(t),this.boundary.moveBy(t)},e.prototype.moveTo=function(t){this.currentPosition.moveTo(t),this.collisionRange.moveTo(this.currentPosition),this.boundary.moveTo(this.currentPosition)},e.prototype.isPointInsideObject=function(t){return B.distance(this.currentPosition,t)<this.radius},Object.defineProperty(e.prototype,"velocity",{get:function(){return B.diff(this.currentPosition,this.previousPosition)},set:function(t){this.previousPosition=B.diff(this.currentPosition,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"movementVector",{get:function(){return new nt(this.previousPosition,this.currentPosition)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius2",{get:function(){return this._radius2},enumerable:!1,configurable:!0}),e.prototype.intersects=function(t){return new st(this.currentPosition,new F(this.radius,this.radius)).intersect(t)},e.prototype.getCollisionRange=function(){return this.collisionRange},e.prototype.getBoundary=function(){return this.boundary},e.prototype.debugRender=function(t){t.strokeStyle("#FF0000");var e=this.getCollisionRange();t.rect(e.left,e.top,e.width,e.height)},e}(rt),ht=function(){function t(t,e){this.solverObject=null,this.renderItem=null,this.solverObject=t,this.renderItem=e}return t.prototype.update=function(){this.renderItem.position=this.solverObject.currentPosition},t.prototype.render=function(){this.update(),this.renderItem.render()},t}(),lt={};t(lt,"ImmovableBallsObject",(function(){return ft}),(function(t){return ft=t}));var pt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ft=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.type=tt.TypeImmovableBall,o.immovable=!0,o.bounceValue=.5,o._fixedPosition=null,o._fixedPosition=e.copy(),o}return pt(e,t),e.prototype.update=function(t){this.currentPosition=this._fixedPosition,this.previousPosition=this._fixedPosition,this.collisionRange.moveTo(this.currentPosition)},e.prototype.addToSpace=function(t){var e=new F(this.radius*M,this.radius*M),n=this.currentPosition.sum(e),o=this.currentPosition.diff(e);t.addRectangularObject(n,o,this)},e.prototype.moveTo=function(e){this.currentPosition=e.copy(),this.previousPosition=e.copy(),this._fixedPosition=e.copy(),t.prototype.moveTo.call(this,e)},e}($.BallsObject);class yt extends ht{update(){super.update(),this.renderItem.direction=this.solverObject._direction}constructor(t,e){var n,o,i;super(t),i=null,(o="solverObject")in(n=this)?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i,this.solverObject=t,this.renderItem=e}}var dt={};t(dt,"ImmovableLineObject",(function(){return mt}),(function(t){return mt=t})),t(dt,"createImmovableLineFrom2Points",(function(){return wt}),(function(t){return wt=t}));var vt={};t(vt,"ImmovableSolverObject",(function(){return gt}),(function(t){return gt=t}));var _t=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _t(e,t),e}(rt),bt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),mt=function(t){function e(e,n){var o=t.call(this)||this;return o.type=tt.TypeImmovableLine,o.immovable=!0,o.bounceValue=1,e instanceof nt?(o.currentPosition=e.vec1.copy(),o.previousPosition=e.vec1.copy(),o._direction=e.direction.copy().flipSelf()):(o.currentPosition=e.copy(),o.previousPosition=e.copy(),o._direction=n),o._line=new nt(o.currentPosition.copy(),o.currentPosition.copy().sum(o._direction)),o.collisionRange=new st(o.currentPosition.sum(o._direction.mul(.5)),o._direction.abs),o}return bt(e,t),e.prototype.update=function(t){this.currentPosition=this._line.vec1,this.previousPosition=this._line.vec2},e.prototype.addToSpace=function(t){t.addRectangularObject(this._line.vec1,this._line.vec2,this)},e.prototype.moveBy=function(t){this.currentPosition.addSelf(t),this.previousPosition.addSelf(t),this._line.moveBy(t),this.collisionRange=new st(this.currentPosition.sum(this._direction.mul(.5)),this._direction.abs)},e.prototype.moveTo=function(t){var e=B.diff(t,this._line.vec1);this.moveBy(e)},e.prototype.debugRender=function(t){t.strokeStyle("#00FF00"),t.line(this._line.vec1,this._line.vec2),t.text("".concat(this.index),this._line.vec1),t.strokeStyle("#FFFFFF"),t.lineWidth(10);var e=this.currentPosition.sum(this._line.normal.flipSelf().mul(100));t.line(this.currentPosition.x,this.currentPosition.y,e.x,e.y),t.lineWidth(1),t.strokeStyle("#FF0000"),t.rect(this.collisionRange.left,this.collisionRange.top,this.collisionRange.width,this.collisionRange.height)},e.prototype.toString=function(){return"ImmovableLine"},e.prototype.inside=function(t){return t.intersect(this.collisionRange)},e.prototype.intersects=function(t){return!!t.intersect(this.collisionRange)&&(!(!t.contains(this._line.vec1)&&!t.contains(this._line.vec2))||(this.collisionRange.top<t.top&&this.collisionRange.bottom>t.top||(this.collisionRange.top<t.bottom&&this.collisionRange.bottom>t.bottom||(this.collisionRange.left<t.left&&this.collisionRange.right>t.left||(this.collisionRange.left<t.right&&this.collisionRange.right>t.right||void 0)))))},e.prototype.isPointInsideObject=function(t){return!1},e.prototype.getCollisionRange=function(){return this.collisionRange},e}(vt.ImmovableSolverObject);function wt(t,e){return new mt(t,B.diff(e,t))}var xt={};t(xt,"Line",(function(){return jt}),(function(t){return jt=t}));var Ot=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),jt=function(t){function e(e,n,o,i){var r=t.call(this,e,n)||this;return r.direction=F.Zero(),r.color="#00ff00",r.direction=o,i&&(r.color=i),r}return Ot(e,t),e.prototype.render=function(){this.renderer.strokeStyle(this.color),this.renderer.vector(this.position,this.direction)},e}(K),Pt={};t(Pt,"CircleWithText",(function(){return Et}),(function(t){return Et=t}));var St=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Et=function(t){function e(e,n,o,i,r,s){var c=t.call(this,e,n,o,i)||this;return c.text="",c.textColor="#ffffff",c.text=r,s&&(c.textColor=s),c}return St(e,t),e.prototype.render=function(){t.prototype.render.call(this),""!==this.text&&(this.renderer.fillStyle(this.textColor),this.renderer.text(this.text,this.position))},e}(q.Circle);function Ct(t){var e=.005,n=Math.floor(127*Math.sin(e*t+0)+128),o=Math.floor(127*Math.sin(e*t+2)+128),i=Math.floor(127*Math.sin(e*t+4)+128);return"rgba(".concat(n,", ").concat(o,", ").concat(i,", 1)")}var Tt={};t(Tt,"ViewportConstrain",(function(){return Bt}),(function(t){return Bt=t}));var It=function(){},kt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Bt=function(t){function e(e,n){var o=t.call(this)||this;return o._width=0,o._height=0,o.width=e,o.height=n,o}return kt(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e.prototype.applyConstrain=function(t){var e=t.currentPosition.copy(),n=!1;t.currentPosition.x-t.radius<0?(e.x=t.radius,n=!0):t.currentPosition.x+t.radius>this._width&&(e.x=this._width-t.radius,n=!0),t.currentPosition.y-t.radius<0?(e.y=t.radius,n=!0):t.currentPosition.y+t.radius>this._height&&(e.y=this._height-t.radius,n=!0),n&&t.moveTo(e)},e}(It),Rt=[new F(0,0),new F(70,380),new F(270,380),new F(340,0),new F(360,0),new F(280,400),new F(60,400),new F(-20,0)];function Mt(t,e){for(var n=e.diff(new F(180*t,200*t)),o=[],i=0;i<Rt.length-1;i++)o.push(new nt(Rt[i].mul(t).sum(n),Rt[i+1].mul(t).sum(n)));return o.push(new nt(Rt[Rt.length-1].mul(t).sum(n),Rt[0].mul(t).sum(n))),o}var Ft=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Lt=function(t){function e(e){var n=t.call(this,e)||this;n.canMoveRedObject=!1;var o=new F(n.engine.canvas.width/2,n.engine.canvas.height/2);return n.generator=n.createBallsGenerator(o,new F(300,300),new F(2,-2)),n.createBottomBouncyLine(),n.createMilkShake(o),n.createActor(),n.initConstrain(),n}return Ft(e,t),e.prototype.createBallsGenerator=function(t,e,n){var o=this,i=t.diff(e),r=n.mul(1/this.engine.solver.subSteps);return new H(this.engine.solver,1e3,7,(function(t){return[new ht(new(0,$.BallsObject)(i,5).setVelocity(r),new(0,Pt.CircleWithText)(o.engine.context,F.Zero(),5,Ct(t+200),"","#000000")),new ht(new(0,$.BallsObject)(i.sum(F.Down(20)),5).setVelocity(r),new(0,Pt.CircleWithText)(o.engine.context,F.Zero(),5,Ct(t+100),"","#000000")),new ht(new(0,$.BallsObject)(i.sum(F.Down(-20)),5).setVelocity(r),new(0,Pt.CircleWithText)(o.engine.context,F.Zero(),5,Ct(t),"","#000000")),new ht(new(0,$.BallsObject)(i.sum(F.Right(-40)),5).setVelocity(r),new(0,Pt.CircleWithText)(o.engine.context,F.Zero(),5,Ct(t-100),"","#000000"))]}))},e.prototype.createBottomBouncyLine=function(){var t=new(0,dt.ImmovableLineObject)(new F(0,this.engine.canvas.height-10),new F(this.engine.canvas.width,0));t.bounceValue=1.5,this.engine.addObject(new yt(t,new(0,xt.Line)(this.engine.context,F.Zero(),F.Zero(),"#ff0000")))},e.prototype.createMilkShake=function(t){var e=this;Mt(1,t).forEach((function(t){e.engine.addObject(new yt(new(0,dt.ImmovableLineObject)(t),new(0,xt.Line)(e.engine.context,F.Zero(),F.Zero(),"#ffffff")))})),Mt(.5,t).forEach((function(t){e.engine.addObject(new yt(new(0,dt.ImmovableLineObject)(t),new(0,xt.Line)(e.engine.context,F.Zero(),F.Zero(),"#0000ff")))}))},e.prototype.initConstrain=function(){this.engine.constrain=new(0,Tt.ViewportConstrain)(this.engine.canvas.width,this.engine.canvas.height)},e.prototype.createActor=function(){this.actor=new ht(new(0,lt.ImmovableBallsObject)(new F(230,50),30),new(0,q.Circle)(this.engine.context,F.Zero(),30,"#ff0000")),this.engine.addObject(this.actor)},e.prototype.getActor=function(){return this.actor},e.prototype.tick=function(t){var e=this;if(this.engine.stats.addStats("Time passed",t),!(t>.017)){var n=this.generator.getNextObjects(t);n&&n.forEach((function(t){return e.engine.addObject(t)}))}},e.prototype.processUserInput=function(t){var e=t;e.leftButtonDown?(this.actor.solverObject.isPointInsideObject(new F(e.screenX,e.screenY))&&(this.canMoveRedObject=!0),this.canMoveRedObject&&this.actor.solverObject.moveBy(new F(e.dx,e.dy))):this.canMoveRedObject=!1},e}(Y),Dt={};t(Dt,"Scene2",(function(){return Zt}),(function(t){return Zt=t}));var zt={};t(zt,"CircleConstrain",(function(){return Vt}),(function(t){return Vt=t}));var At=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Vt=function(t){function e(e,n){var o=t.call(this)||this;return o.center=F.Zero(),o.radius=0,o.center=e,o.radius=n,o}return At(e,t),e.prototype.applyConstrain=function(t){var e=t.currentPosition.diff(this.center),n=e.length,o=t.radius||0;if(n>this.radius-o){var i=e.ort;t.moveTo(this.center.sum(i.mul(this.radius-o)))}},e}(It),Nt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Zt=function(t){function e(e){var n=t.call(this,e)||this;return n._canMoveRedObject=!1,n.timePassedSinceLastBallCreated=0,n.ballIndex=0,n.center=new F(n.engine.canvas.width/2,n.engine.canvas.height/2),n.radius=Math.min(n.center.x,n.center.y),n.generator=new W(n.engine.solver),n.createActor(),n.initConstrain(),n}return Nt(e,t),e.prototype.createBall=function(){new F(0,0);var t=this.actor.solverObject.currentPosition,e=t.diff(this.center).ort,n=e.mul(-1),o=new ht(new(0,$.BallsObject)(t.diff(e.mul(40)),5).setVelocity(n),new(0,Pt.CircleWithText)(this.engine.context,F.Zero(),7,Ct(this.ballIndex+200),"","#000000"));this.engine.addObject(o),this.ballIndex++},e.prototype.createActor=function(){this.actor=new ht(new(0,lt.ImmovableBallsObject)(new F(230,50),30),new(0,q.Circle)(this.engine.context,F.Zero(),30,"#ff0000")),this.engine.addObject(this.actor)},e.prototype.initConstrain=function(){this.engine.constrain=new(0,zt.CircleConstrain)(this.center,this.radius),this.engine.items.push(new(0,q.Circle)(this.engine.context,this.center,this.radius,"#ffffff"))},e.prototype.getActor=function(){return this.actor},e.prototype.tick=function(t){this.canMoveRedObject&&(this.timePassedSinceLastBallCreated+=t,this.timePassedSinceLastBallCreated>.05&&(this.timePassedSinceLastBallCreated=0,this.createBall()))},e.prototype.processUserInput=function(t){var e=t;e.leftButtonDown?(this.actor.solverObject.isPointInsideObject(new F(e.screenX,e.screenY))&&(this.canMoveRedObject=!0),this.canMoveRedObject):this.canMoveRedObject=!1,(e.screenX||e.screenY)&&this.actor.solverObject.moveTo(new F(e.screenX,e.screenY))},Object.defineProperty(e.prototype,"canMoveRedObject",{get:function(){return this._canMoveRedObject},set:function(t){this._canMoveRedObject=t,this.actor.renderItem.color=t?"#00ff00":"#ff0000"},enumerable:!1,configurable:!0}),e}(Y),Xt={};t(Xt,"Scene3",(function(){return ee}),(function(t){return ee=t}));var Gt={};t(Gt,"ImmovablePolygon",(function(){return Wt}),(function(t){return Wt=t}));var Ut=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Yt=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Wt=function(t){function e(e,n){var o=t.call(this)||this;return o._localPoints=[],o._lines=[],o.type=tt.TypeImmovablePolygon,o.immovable=!0,o.bounceValue=1,o.currentPosition=e.copy(),o.previousPosition=e.copy(),o._fixedPosition=e.copy(),n.forEach((function(t){o._localPoints.push(t.copy())})),o._recreateLines(),o}return Ut(e,t),e.prototype._recreateLines=function(){var t,e=Yt([],this._localPoints,!0).reverse(),n=e.shift(),o=n;for(this._lines.splice(0,this._lines.length);t=e.shift();){var i=(0,dt.createImmovableLineFrom2Points)(this._fixedPosition.sum(o),this._fixedPosition.sum(t));this._lines.push(i),o=t}var r=(0,dt.createImmovableLineFrom2Points)(this._fixedPosition.sum(o),this._fixedPosition.sum(n));this._lines.push(r)},e.prototype.update=function(t){this.currentPosition=this._fixedPosition,this.previousPosition=this._fixedPosition},e.prototype.addToSpace=function(t){try{this._lines.forEach((function(e){return e.addToSpace(t)}))}catch(t){console.log(t,this._lines)}},e.prototype.isPointInsideObject=function(t){return!0},e.prototype.moveBy=function(t){this._fixedPosition.addSelf(t),this._lines.forEach((function(e){return e.moveBy(t)}))},e.prototype.moveTo=function(t){var e=B.diff(t,this._fixedPosition);this.moveBy(e)},e.prototype.toString=function(){return"ImmovablePolygon"},e.prototype.debugRender=function(t){t.strokeStyle("#00FF00"),this._lines.forEach((function(e){return e.debugRender(t)}))},Object.defineProperty(e.prototype,"lines",{get:function(){return this._lines},enumerable:!1,configurable:!0}),e.prototype.intersects=function(t){return this._lines.some((function(e){return e.intersects(t)}))},e.prototype.getCollisionRange=function(){return new st(this.currentPosition,new F(60,60))},e}(vt.ImmovableSolverObject),Ht={};t(Ht,"PolygonRainbow",(function(){return $t}),(function(t){return $t=t}));var qt={};t(qt,"Polygon",(function(){return Qt}),(function(t){return Qt=t}));var Kt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Qt=function(t){function e(e,n,o,i){var r=t.call(this,e,n)||this;return r.direction=F.Zero(),r.color="#00ff00",r.points=o,i&&(r.color=i),r}return Kt(e,t),e.prototype.render=function(){var t=this;this.renderer.strokeStyle(this.color),this.renderer.polygon(this.points.map((function(e){return e.sum(t.position)})))},e}(K),Jt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),$t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Jt(e,t),e}(qt.Polygon),te=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ee=function(t){function e(e){var n=t.call(this,e)||this;return n._createBalls=!1,n.timePassedSinceLastBallCreated=0,n.ballIndex=0,n.ballsViews=[],n.center=new F(n.engine.canvas.width/2,n.engine.canvas.height/2),n.radius=Math.min(n.center.x,n.center.y),n.generator=new W(n.engine.solver),n.createActor(),n.initConstrain(),n}return te(e,t),e.prototype.createBall=function(){new F(0,0);var t=this.actor.solverObject.currentPosition,e=t.diff(this.center).ort,n=e.mul(-1),o=20+30*Math.random(),i=new(0,Pt.CircleWithText)(this.engine.context,F.Zero(),o,Ct(this.ballIndex+200),"","#000000");this.ballsViews.push(i);var r=new ht(new(0,$.BallsObject)(t.diff(e.mul(40)),o).setVelocity(n),i);this.engine.addObject(r),this.ballIndex++},e.prototype.createActor=function(){var t,e,n,o=(e=(t=60)*Math.sqrt(3)/2,n=new F(t/2,t/2*(1/Math.sqrt(3))),[new F(-n.x,-n.y),new F(0,e-n.y),new F(n.x,-n.y)]);this.nextTickActorPosition=this.center;var i=new(0,Gt.ImmovablePolygon)(this.center,o),r=new(0,Ht.PolygonRainbow)(this.engine.context,F.Zero(),o,"#ff0000");this.actor=new ht(i,r),this.engine.addObject(this.actor)},e.prototype.initConstrain=function(){this.engine.constrain=new(0,zt.CircleConstrain)(this.center,this.radius),this.engine.items.push(new(0,q.Circle)(this.engine.context,this.center,this.radius,"#555555"))},e.prototype.getActor=function(){return this.actor},e.prototype.tick=function(t){this.actor.solverObject.moveTo(this.nextTickActorPosition),this.createBalls&&(this.timePassedSinceLastBallCreated+=t,this.timePassedSinceLastBallCreated>.05&&(this.timePassedSinceLastBallCreated=0,this.createBall())),this.ballsViews.forEach((function(t){t.color=Ct(t.position.y)}))},e.prototype.processUserInput=function(t){var e=t;e.leftButtonDown?this.actor.solverObject.isPointInsideObject(new F(e.screenX,e.screenY))&&(this.createBalls=!0):this.createBalls=!1,(e.screenX||e.screenY)&&(this.nextTickActorPosition=new F(e.screenX,e.screenY))},Object.defineProperty(e.prototype,"createBalls",{get:function(){return this._createBalls},set:function(t){this._createBalls=t,this.actor.renderItem.color=t?"#00ff00":"#ff0000"},enumerable:!1,configurable:!0}),e}(Y),ne={scene1:U.Scene1,scene2:Dt.Scene2,scene3:Xt.Scene3},oe=function(){function t(){this.tickData=[],this.totalData=[],this.keys=new Map}return t.prototype.resetTick=function(){var t=this;this.tickData.forEach((function(e,n){return t.tickData[n]=0}))},t.prototype.writeStats=function(t,e){var n=this.registerKey(t);this.tickData[n]=e,this.totalData[n]=e},t.prototype.addStats=function(t,e){void 0===e&&(e=1);var n=this.registerKey(t);this.tickData[n]+=e,this.totalData[n]+=e},t.prototype.registerKey=function(t){return this.keys.has(t)?this.keys.get(t):(this.tickData.push(0),this.totalData.push(0),this.keys.set(t,this.tickData.length-1),this.tickData.length-1)},t.prototype.getStats=function(t){if(!this.keys.has(t))return{key:t,total:0,tick:0};var e=this.keys.get(t);return{key:t,total:this.totalData[e],tick:this.tickData[e]}},t.prototype.getTickData=function(){var t=this,e=[];return this.keys.forEach((function(n,o){e.push({key:o,value:t.tickData[n]})})),e},t}(),ie={};t(ie,"QuadTreeSolver",(function(){return he}),(function(t){return he=t}));var re={};t(re,"QuadTreeSolverSpace",(function(){return ue}),(function(t){return ue=t}));var se=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ce=function(){function t(t,e){this.divided=!1,this.minimumDiag=10,this.boundary=t.copy(),this.capacity=e,this.objects=[],this.nodes=[],this.divided=!1}return t.prototype.clear=function(){this.objects.length>0&&this.objects.splice(0),this.divided&&this.nodes.forEach((function(t){return t.clear()})),this.divided=!1},Object.defineProperty(t.prototype,"canSubdivide",{get:function(){return this.boundary.diag>this.minimumDiag},enumerable:!1,configurable:!0}),t.prototype.insert=function(t){if(t.inside(this.boundary)){if(this.objects.length<this.capacity)return this.objects.push(t),!0;if(!this.canSubdivide)return this.objects.push(t),!0;this.divided||(this.subdivide(),this.divided=!0);for(var e=0;e<4;)this.nodes[e].insert(t)&&(e=5),e++;return 5===e}},t.prototype.subdivide=function(){this.nodes[t.NW]=new t(this.boundary.nw,this.capacity),this.nodes[t.NE]=new t(this.boundary.ne,this.capacity),this.nodes[t.SE]=new t(this.boundary.se,this.capacity),this.nodes[t.SW]=new t(this.boundary.sw,this.capacity)},t.prototype.query=function(t){var e=[];return this.boundary.intersect(t)?(this.objects.forEach((function(n){n.intersects(t)&&e.push(n)})),this.divided&&this.nodes.forEach((function(n){return n.query(t).forEach((function(t){return e.push(t)}))})),e):e},t.prototype.debugRender=function(t){t.strokeStyle(this.objects.length>0?"#ff0000":"#00ff00"),t.rect(this.boundary.left,this.boundary.top,this.boundary.width-2,this.boundary.height-2),this.divided&&this.nodes.forEach((function(e){return e.debugRender(t)}))},t.NW=0,t.NE=1,t.SE=2,t.SW=3,t}(),ue=function(t){function e(e,n){var o=t.call(this)||this;return o.root=new ce(new st(new F(e/2,n/2),new F(e,n)),4),o}return se(e,t),e.prototype.clear=function(){this.root.clear()},e.prototype.addObject=function(t){this.root.insert(t)},e.prototype.addPointObject=function(t,e,n){this.root.insert(n)},e.prototype.addRectangularObject=function(t,e,n){this.root.insert(n)},e.prototype.debugRender=function(t){this.root.debugRender(t)},e}(z),ae=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),he=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.gravity=F.Zero(),o.configure(),o}return ae(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.space.clear()},e.prototype.configure=function(){t.prototype.configure.call(this),this.gravity=new F(0,100),this.space=new(0,re.QuadTreeSolverSpace)(this.worldSize.x,this.worldSize.y)},e.prototype.processOptimizations=function(){var t=this;this.space.clear(),this.objects.forEach((function(e,n){e.addToSpace(t.space),t.stats.addStats("Solver object: ".concat(e.toString()))}))},e.prototype.applyForces=function(){var t=this;this.objects.forEach((function(e){return e.accelerate(t.gravity)}))},e.prototype.processCollisions=function(){var t=this;this.objects.forEach((function(e){var n=e.getCollisionRange(),o=t.space.root.query(n);t.stats.addStats("processCollisions.queryPossibleObjects.calls"),o.forEach((function(n){e!==n&&(e.immovable&&n.immovable||(t.stats.addStats("processCollisions.calls"),e.collide(n)))}))}))},e.prototype.debugRender=function(t){this.space.debugRender(t),this.objects.forEach((function(e){return e.debugRender(t)}))},e}(Z);var le={};t(le,"Canvas2DRender",(function(){return de}),(function(t){return de=t}));var pe,fe=function(){function t(){this._position=F.Zero()}return t.prototype.moveTo=function(t,e){this._position.moveTo(t,e)},t}(),ye=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),de=function(t){function e(e){var n=t.call(this)||this;return n._context=e,n}return ye(e,t),e.prototype.getCoord=function(t,e){var n,o;return void 0===t?(n=this._position.x,o=this._position.y):t instanceof F?(n=t.x,o=t.y):(n=t,o=e),[n,o]},e.prototype.circle=function(t,e,n){var o=this.getCoord(e,n),i=o[0],r=o[1];this._context.beginPath(),this._context.arc(i,r,t,0,2*Math.PI),this._context.stroke()},e.prototype.fillCircle=function(t,e,n){var o=this.getCoord(e,n),i=o[0],r=o[1];this._context.beginPath(),this._context.arc(i,r,t,0,2*Math.PI),this._context.fill()},e.prototype.color=function(){},e.prototype.fillStyle=function(t){this._context.fillStyle=t},e.prototype.fillRect=function(t,e,n,o){this._context.fillRect(t,e,n-t,o-e)},e.prototype.line=function(t,e,n,o){var i,r,s;e instanceof F?(t=(i=this.getCoord(t))[0],e=i[1],n=(r=this.getCoord(e))[0],o=r[1]):(t=(s=this.getCoord(t,e))[0],e=s[1]),this._context.beginPath(),this._context.moveTo(t,e),this._context.lineTo(n,o),this._context.stroke()},e.prototype.vector=function(t,e){this._context.beginPath(),this._context.moveTo(t.x,t.y),this._context.lineTo(t.x+e.x,t.y+e.y),this._context.stroke()},e.prototype.rect=function(t,e,n,o){this._context.strokeRect(t,e,n,o)},e.prototype.text=function(t,e,n){var o=this.getCoord(e,n),i=o[0],r=o[1];this._context.fillStyle="#ffffff",this._context.textAlign="start",this._context.fillText(t,i,r)},e.prototype.moveTo=function(){},e.prototype.font=function(t){this._context.font=t},e.prototype.lineTo=function(t,e){var n=this.getCoord(t,e),o=n[0],i=n[1];this._context.moveTo(this._position.x,this._position.y),this._context.lineTo(o,i)},e.prototype.strokeStyle=function(t){this._context.strokeStyle=t},e.prototype.lineWidth=function(t){this._context.lineWidth=t},e.prototype.polygon=function(t){this._context.beginPath();var e=0;for(this._context.moveTo(t[e].x,t[e].y);e<t.length-1;)e++,this._context.lineTo(t[e].x,t[e].y);this._context.lineTo(t[0].x,t[0].y),this._context.stroke()},e}(fe),ve=function(){function t(t){var e=this;this.objects=[],this._constrains=null,this.solver=null,this.flagRenderGrid=!1,this.flagRenderPreviousPosition=!1,this.flagSwitchSolver=!1,this.nextFrame=function(t){e.step=t-e.timeRenderEnd,e.step<0&&(e.step=0),e.tick(),e.timeRenderEnd=t,self.requestAnimationFrame(e.nextFrame)},this.nextInterval=function(){e.timeRenderStart=performance.now(),e.step=e.timeRenderStart-e.timeRenderEnd,e.step<0&&(e.step=0),e.tick(),e.timeRenderEnd=performance.now()},this.stats=new oe,this.canvas=t,this.context=new(0,le.Canvas2DRender)(this.canvas.getContext("2d")),this.timeRenderStart=performance.now(),this.timeRenderEnd=performance.now(),this.step=0,this.objects=[],this.items=[],this.solver=null,this.configure()}return t.prototype.reset=function(){this.objects=[],this.items=[],this.solver.reset()},t.prototype.switchToGridSolver=function(){var t=new(0,L.GridOptimizedSolver)(new F(this.canvas.width,this.canvas.height),this.stats);this.solver&&(this.solver.objects.forEach((function(e){return t.addObject(e)})),t.constrains=this._constrains),this.solver=t},t.prototype.switchToQuadSolver=function(){var t=new(0,ie.QuadTreeSolver)(new F(this.canvas.width,this.canvas.height),this.stats);this.solver&&(this.solver.objects.forEach((function(e){return t.addObject(e)})),t.constrains=this._constrains),this.solver=t},t.prototype.configure=function(){this.switchToGridSolver(),this.context.font("10px serif"),this.loadScene("scene1")},t.prototype.processUserInput=function(t){var e=t;"g"===e.keyPressed&&(this.flagRenderGrid=!this.flagRenderGrid),"p"===e.keyPressed&&(this.flagRenderPreviousPosition=!this.flagRenderPreviousPosition),"s"===e.keyPressed&&(this.flagSwitchSolver=!0),this.scene.processUserInput(t)},t.prototype.processEngineEvent=function(t){var e=t;e.scene&&this.loadScene(e.scene)},t.prototype.loadScene=function(t){this.reset();var e=ne[t];this.scene=new e(this)},t.prototype.addObject=function(t){this.objects.push(t),this.solver.addObject(t.solverObject)},t.prototype.update=function(t){this.solver.update(t)},t.prototype.tick=function(){this.step<0&&(this.step=0);var t=this.step/1e3;this.scene.tick(t),this.update(t),this.clear(),this.renderItems(),this.flagRenderGrid&&this.renderGrid(),this.flagRenderPreviousPosition&&this.renderPreviousPosition(),this.printFPS(),this.stats.resetTick(),F.lengthCallsCount=0,F.length2CallsCount=0,this.flagSwitchSolver&&(this.solver instanceof L.GridOptimizedSolver?this.switchToQuadSolver():this.switchToGridSolver(),this.flagSwitchSolver=!1)},t.prototype.renderItems=function(){this.items.forEach((function(t){return t.render()})),this.objects.forEach((function(t){return t.render()}))},t.prototype.printFPS=function(){var t=this;this.context.fillStyle("rgba(0,0,0,0.1)"),this.context.fillRect(0,0,100,60),this.context.text("".concat(Math.round(this.step)," ms / ").concat(Math.round(1e3/this.step)," FPS"),0,10),this.context.text("Length calls: ".concat(F.lengthCallsCount),0,20),this.context.text("Lenght2 calls: ".concat(F.length2CallsCount),0,30),this.context.text("Objects: ".concat(this.objects.length),0,40),this.context.text("Compares per object: ".concat(Math.round(F.lengthCallsCount/this.objects.length)),0,50),this.stats.getTickData().forEach((function(e,n){t.context.text("".concat(e.key,": ").concat(e.value),0,10*n+60)}))},t.prototype.clear=function(){this.context.fillStyle("rgba(0, 0, 0, 0.9)"),this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t.prototype.start=function(){self.requestAnimationFrame?self.requestAnimationFrame(this.nextFrame):setInterval(this.nextInterval,16)},t.prototype.renderGrid=function(){this.solver.debugRender(this.context)},t.prototype.renderPreviousPosition=function(){var t=this;this.objects.forEach((function(e){var n=e.solverObject.previousPosition;t.context.fillStyle("rgba(0, 0, 255, 0.5)"),t.context.fillCircle(10,n)}))},Object.defineProperty(t.prototype,"constrain",{get:function(){return this._constrains},set:function(t){this._constrains=t,this.solver.constrains=this._constrains},enumerable:!1,configurable:!0}),t}(),_e=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ge=function(t){function e(e){var n=t.call(this)||this;return n.sendUserInputEvent=function(t){n.render.processUserInput(t)},n.sendEngineEvent=function(t){n.render.processEngineEvent(t)},n.render=new ve(e),n.render.start(),n.userInput=new a(e),n.userInput.addHandler(n.sendUserInputEvent),n}return _e(e,t),e}(x);pe=function(){console.log("Init application");const t=c("#image_canvas"),e=c("#container");let n;t.width=e.offsetWidth,t.height=e.offsetHeight,t.transferControlToOffscreen?(console.log("Render in worker"),n=new(0,u.WorkerApplication)(t)):(console.log("Render in main thread"),n=new(0,P.DirectApplication)(t));const o=c("#scene1"),i=c("#scene2"),r=c("#scene3");o.addEventListener("click",(t=>{t.preventDefault(),n.loadScene("scene1")})),i.addEventListener("click",(t=>{t.preventDefault(),n.loadScene("scene2")})),r.addEventListener("click",(t=>{t.preventDefault(),n.loadScene("scene3")}))},document.readyState!==r?pe():document.addEventListener("DOMContentLoaded",pe);